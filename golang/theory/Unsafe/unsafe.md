# ‚ö†Ô∏è –ü–∞–∫–µ—Ç unsafe: –ü—Ä–æ–≥—É–ª–∫–∞ –ø–æ –ª–µ–∑–≤–∏—é –±—Ä–∏—Ç–≤—ã

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ß—Ç–æ —Ç–∞–∫–æ–µ unsafe?](#—á—Ç–æ-—Ç–∞–∫–æ–µ-unsafe)
2. [–û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)
3. [Pointer vs uintptr](#pointer-vs-uintptr)
4. [üî• –û–ø–∞—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –ú–µ–Ω—è–µ–º "–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—É—é" —Å—Ç—Ä–æ–∫—É](#–æ–ø–∞—Å–Ω—ã–π-–ø—Ä–∏–º–µ—Ä-–º–µ–Ω—è–µ–º-–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—É—é-—Å—Ç—Ä–æ–∫—É)
5. [–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?](#–∑–∞—á–µ–º-–µ–≥–æ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)

---

## ‚ùì –ß—Ç–æ —Ç–∞–∫–æ–µ unsafe?

**unsafe** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –≤ Go, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ö–æ–¥–∏—Ç—å —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —è–∑—ã–∫–∞. –û–±—ã—á–Ω–æ Go –Ω–µ –¥–∞–µ—Ç –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ø–∞–º—è—Ç–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–ª–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –æ–¥–∏–Ω —Ç–∏–ø –∫ –¥—Ä—É–≥–æ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `int` –∫ `string`), –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ. 

–ü–∞–∫–µ—Ç `unsafe` –≥–æ–≤–æ—Ä–∏—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É: *"–Ø –∑–Ω–∞—é, —á—Ç–æ –¥–µ–ª–∞—é, –Ω–µ –º–µ—à–∞–π –º–Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å—ã—Ä—ã–º–∏ –∞–¥—Ä–µ—Å–∞–º–∏ –ø–∞–º—è—Ç–∏"*. üõ°Ô∏è‚õî

---

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–í –ø–∞–∫–µ—Ç–µ –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π –∏ –æ–¥–∏–Ω –æ—Å–æ–±—ã–π —Ç–∏–ø:

1.  **unsafe.Pointer**: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å. –≠—Ç–æ "–º–æ—Å—Ç–∏–∫", —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –ª—é–±–æ–π —É–∫–∞–∑–∞—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `*int`) –º–æ–∂–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π (`*string`).
2.  **unsafe.Sizeof**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–º–µ—Ä —Ç–∏–ø–∞ –≤ –±–∞–π—Ç–∞—Ö.
3.  **unsafe.Offsetof**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç—Å—Ç—É–ø –ø–æ–ª—è –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
4.  **unsafe.Alignof**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–∏–ø–∞.

---

## üß† Pointer vs uintptr

–≠—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é:

- **unsafe.Pointer**: –≠—Ç–æ –≤—Å–µ –µ—â–µ —É–∫–∞–∑–∞—Ç–µ–ª—å –¥–ª—è —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞ (GC). –ï—Å–ª–∏ GC —Ä–µ—à–∏—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –æ–±—ä–µ–∫—Ç –≤ –ø–∞–º—è—Ç–∏, –æ–Ω –æ–±–Ω–æ–≤–∏—Ç —ç—Ç–æ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å.
- **uintptr**: –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ **—á–∏—Å–ª–æ** (—Ü–µ–ª–æ–µ –±–µ–∑–∑–Ω–∞–∫–æ–≤–æ–µ), –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–µ–µ –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏. GC –µ–≥–æ "–Ω–µ –≤–∏–¥–∏—Ç". –ï—Å–ª–∏ –≤—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∞–¥—Ä–µ—Å –≤ `uintptr`, –∞ GC –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç –æ–±—ä–µ–∫—Ç ‚Äî –≤–∞—à–µ —á–∏—Å–ª–æ —Å—Ç–∞–Ω–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –º—É—Å–æ—Ä. üóëÔ∏è

> [!CAUTION]
> **–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ**: –ü—Ä–µ–≤—Ä–∞—â–∞–π—Ç–µ `Pointer` –≤ `uintptr` —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏ (–ø—Ä–∏–±–∞–≤–∏—Ç—å –æ—Ç—Å—Ç—É–ø) –∏ **—Å—Ä–∞–∑—É –∂–µ** –ø—Ä–µ–≤—Ä–∞—â–∞–π—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ `Pointer`. –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ `uintptr` –¥–æ–ª–≥–æ!

---

## üî• –û–ø–∞—Å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –ú–µ–Ω—è–µ–º "–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—É—é" —Å—Ç—Ä–æ–∫—É

–í Go —Å—Ç—Ä–æ–∫–∏ (`string`) ‚Äî —ç—Ç–æ read-only —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ù–æ —á–µ—Ä–µ–∑ `unsafe` –º—ã –º–æ–∂–µ–º –∑–∞–ª–µ–∑—Ç—å –ø–æ–¥ –∫–∞–ø–æ—Ç –∏ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.

```mermaid
graph LR
    S[String Variable] --> SH[StringHeader]
    subgraph SH [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ StringHeader]
    Data[Data: Pointer to bytes]
    Len[Len: 5]
    end
    Data --> Bytes[H, e, l, l, o]
```

### –ö–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å (–ø—Ä–∞–∫—Ç–∏–∫–∞):

```go
package main

import (
	"fmt"
	"unsafe"
)

func main() {
	s := "Hello"
	fmt.Println("–î–æ:", s)

	// 1. –ü–æ–ª—É—á–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–∞–∑–æ–≤—ã–π –º–∞—Å—Å–∏–≤ –±–∞–π—Ç —Å—Ç—Ä–æ–∫–∏
	// –ú—ã –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º –∞–¥—Ä–µ—Å —Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ –∞–¥—Ä–µ—Å —Å–ª–∞–π—Å–∞ –±–∞–π—Ç.
	// –í–Ω–∏–º–∞–Ω–∏–µ: StringHeader –∏ SliceHeader –∏–º–µ—é—Ç —Ä–∞–∑–Ω—É—é –¥–ª–∏–Ω—É, 
	// –Ω–æ –ø–µ—Ä–≤—ã–µ –¥–≤–∞ –ø–æ–ª—è (Data –∏ Len) —É –Ω–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ.
	b := *(*[]byte)(unsafe.Pointer(&s))

	// 2. –¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –º–µ–Ω—è—Ç—å –±–∞–π—Ç—ã –≤ –ø–∞–º—è—Ç–∏
	// –≠—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ read-only –ø–∞–º—è—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –æ–Ω–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
	// –î–ª—è –ª–∏—Ç–µ—Ä–∞–ª–æ–≤ —ç—Ç–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤—ã–∑–æ–≤–µ—Ç SEGFAULT.
	// b[0] = 'H' // –í —Ç–µ–æ—Ä–∏–∏ —Ç–∞–∫, –Ω–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
	
	fmt.Printf("–£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ: %v\n", unsafe.Pointer(&b[0]))
}
```

> [!WARNING]
> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫ —á–µ—Ä–µ–∑ `unsafe` ‚Äî —ç—Ç–æ **Undefined Behavior**. –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Go —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã –æ–±—ã—á–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ "—Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è". –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å –∏—Ö –≤—ã–∑–æ–≤–µ—Ç **panic: runtime error: invalid memory address or nil pointer dereference** –∏–ª–∏ **segmentation fault**.

---

## üèóÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞—Å—Ç–∏–Ω–≥ –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è?

–û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —á–∞—Å—Ç—ã—Ö "–ª–µ–≥–∞–ª—å–Ω—ã—Ö" —Å–ø–æ—Å–æ–±–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `unsafe` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è `[]byte` –≤ `string` –±–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –ø–∞–º—è—Ç–∏ –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:

```go
func BytesToString(b []byte) string {
    return *(*string)(unsafe.Pointer(&b))
}
```
–ó–¥–µ—Å—å –º—ã –ø—Ä–æ—Å—Ç–æ –≥–æ–≤–æ—Ä–∏–º Go —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ç–µ –∂–µ —Å–∞–º—ã–µ –±–∞–π—Ç—ã –≤ –ø–∞–º—è—Ç–∏, –Ω–æ —Å—á–∏—Ç–∞—Ç—å –∏—Ö —Å—Ç—Ä–æ–∫–æ–π. –≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è –∏ –ø–∞–º—è—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## üöÄ –ó–∞—á–µ–º –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

–ï—Å–ª–∏ —ç—Ç–æ —Ç–∞–∫ –æ–ø–∞—Å–Ω–æ, –ø–æ—á–µ–º—É –ø–∞–∫–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?

1.  **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ `[]byte` –∫ `string` –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.
2.  **Interoperability (cgo)**: –î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —è–∑—ã–∫–µ C.
3.  **–°–∏—Å—Ç–µ–º–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ï—Å–ª–∏ –≤—ã –ø–∏—à–µ—Ç–µ —Å–≤–æ–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏ –∏–ª–∏ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –¥—Ä–∞–π–≤–µ—Ä.
4.  **–î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –ø–æ–ª—è–º**: –ú–æ–∂–Ω–æ –≤—ã—Å—á–∏—Ç–∞—Ç—å –æ—Ç—Å—Ç—É–ø (`Offsetof`) –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –ø–æ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑ –¥—Ä—É–≥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –µ–≥–æ. üïµÔ∏è‚Äç‚ôÇÔ∏è

---

## üèÅ –†–µ–∑—é–º–µ

- `unsafe` ‚Äî —ç—Ç–æ **–≤–∑–ª–æ–º** –ø—Ä–∞–≤–∏–ª Go.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã –∑–∞–º–µ—Ä–∏–ª–∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫–æ–º –∏ –ø–æ–Ω—è–ª–∏, —á—Ç–æ —ç—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π** —Å–ø–æ—Å–æ–± —É—Å–∫–æ—Ä–∏—Ç—å –∫–æ–¥.
- –ü–æ–º–Ω–∏—Ç–µ –ø—Ä–æ **GC**: –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∞–π—Ç–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –≤–Ω–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ —Å –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤.
- –ï—Å–ª–∏ –º–æ–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å `unsafe` ‚Äî **–∏–∑–±–µ–≥–∞–π—Ç–µ –µ–≥–æ**. üö´

---

> [!IMPORTANT]
> –ü—Ä–æ–≥—Ä–∞–º–º—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `unsafe`, –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å—Ç–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ Go, —Ç–∞–∫ –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä—É–∫—Ç—É—Ä —Å—Ç—Ä–æ–∫ –∏–ª–∏ —Å–ª–∞–π—Å–æ–≤) –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è.
