### üó∫Ô∏è –ß—Ç–æ —Ç–∞–∫–æ–µ map?

**map** ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤ Go, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π **—Ö—ç—à-—Ç–∞–±–ª–∏—Ü—É**. –≠—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä "–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ" (**key-value**), –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ (`m["key"] = value`).
- –ü–æ–∏—Å–∫ (`value := m["key"]`).
- –£–¥–∞–ª–µ–Ω–∏–µ (`delete(m, "key")`).

–í –∏–¥–µ–∞–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞ O(1) ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è.

---

# 1. üèõÔ∏è –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (`map` < Go 1.24)

–î–æ –≤–µ—Ä—Å–∏–∏ 1.24 Go –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∫–ª–∞—Å—Å–∏—á–µ—Å–∫—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ö—ç—à-—Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ **–±–∞–∫–µ—Ç–æ–≤** –∏ **overflow-—Ü–µ–ø–æ—á–µ–∫**.

## ‚öôÔ∏è –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ `map` (hmap)

–í–Ω—É—Ç—Ä–∏ `map` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ **hmap** (hash map) –≤ runtime Go:

```go
type hmap struct {
    count     int       // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    B         uint8     // –õ–æ–≥–∞—Ä–∏—Ñ–º —Ä–∞–∑–º–µ—Ä–∞ –º–∞—Å—Å–∏–≤–∞ –±–∞–∫–µ—Ç–æ–≤ (2^B)
    buckets   []bmap    // –ú–∞—Å—Å–∏–≤ –±–∞–∫–µ—Ç–æ–≤
    oldbuckets []bmap   // –°—Ç–∞—Ä—ã–π –º–∞—Å—Å–∏–≤ –±–∞–∫–µ—Ç–æ–≤ (–ø—Ä–∏ —Ä–æ—Å—Ç–µ)
    hash0     uint32    // –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏–∏ (seed)
}
```

- **count**: –°–∫–æ–ª—å–∫–æ –ø–∞—Ä "–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ" –≤ —Ç–∞–±–ª–∏—Ü–µ.
- **B**: –†–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ –±–∞–∫–µ—Ç–æ–≤ –∫–∞–∫ —Å—Ç–µ–ø–µ–Ω—å –¥–≤–æ–π–∫–∏ ($2^B$). –ù–∞–ø—Ä–∏–º–µ—Ä, $B = 3 \to 8$ –±–∞–∫–µ—Ç–æ–≤.
- **buckets**: –°—Ä–µ–∑, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ –º–∞—Å—Å–∏–≤ –±–∞–∫–µ—Ç–æ–≤.
- **oldbuckets**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —ç–≤–∞–∫—É–∞—Ü–∏–∏.
- **hash0**: –°–ª—É—á–∞–π–Ω—ã–π **seed** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∫–æ–ª–ª–∏–∑–∏–π.

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–±–æ—Ä –±–∞–∫–µ—Ç–∞

1. **–•—ç—à-—Ñ—É–Ω–∫—Ü–∏—è**: –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∫–ª—é—á –≤ 64-–±–∏—Ç–Ω–æ–µ —á–∏—Å–ª–æ. Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, **aeshash** –¥–ª—è —Å—Ç—Ä–æ–∫).
2. **–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å**: `hash0` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º, —á—Ç–æ–±—ã —Ö—ç—à–∏ –º–µ–Ω—è–ª–∏—Å—å –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–ª–ª–∏–∑–∏–π).
3. **–ò–Ω–¥–µ–∫—Å –±–∞–∫–µ—Ç–∞**: –ë–µ—Ä—É—Ç—Å—è –º–ª–∞–¥—à–∏–µ –±–∏—Ç—ã —Ö—ç—à–∞. –î–ª—è 8 –±–∞–∫–µ—Ç–æ–≤ ($B=3$) ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –±–∏—Ç–∞.
   - `123456789 ‚Üí ...101 ‚Üí –±–∞–∫–µ—Ç 5`.

## üì¶ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –±–∞–∫–µ—Ç–∞ (bmap)

–ö–∞–∂–¥—ã–π –±–∞–∫–µ—Ç ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ **8 –ø–∞—Ä** "–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ".

```go
bmap {
    tophash:  [8]uint8    // –í–µ—Ä—Ö–Ω–∏–µ 8 –±–∏—Ç —Ö—ç—à–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
    keys:     [8]string   // 8 –∫–ª—é—á–µ–π
    values:   [8]int      // 8 –∑–Ω–∞—á–µ–Ω–∏–π
    overflow: *bmap       // –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –±–∞–∫–µ—Ç (–ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏)
}
```

- **tophash**: –ü–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –æ—Ç—Å–µ—è—Ç—å –∫–ª—é—á–∏, –Ω–µ –≤—ã–ø–æ–ª–Ω—è—è –ø–æ–ª–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ.
- **–ö–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è**: –•—Ä–∞–Ω—è—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ (—Å–Ω–∞—á–∞–ª–∞ –≤—Å–µ 8 –∫–ª—é—á–µ–π, –ø–æ—Ç–æ–º –≤—Å–µ 8 –∑–Ω–∞—á–µ–Ω–∏–π), —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å padding –≤ –ø–∞–º—è—Ç–∏.

### –ö–æ–ª–ª–∏–∑–∏–∏ –∏ Overflow

–ï—Å–ª–∏ –≤ –±–∞–∫–µ—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –±–æ–ª–µ–µ 8 —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —Å–æ–∑–¥–∞–µ—Ç—Å—è **overflow-–±–∞–∫–µ—Ç**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É —Ü–µ–ø–æ—á–∫–æ–π. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–æ–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω–µ–µ ($O(N)$ –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ –¥–ª—è –æ–¥–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏).

## üìà –†–æ—Å—Ç –∏ –≠–≤–∞–∫—É–∞—Ü–∏—è

> [!NOTE]
> **–≠–≤–∞–∫—É–∞—Ü–∏—è** ‚Äî —ç—Ç–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –Ω–æ–≤—ã–µ –±–∞–∫–µ—Ç—ã –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã.

1. **–ö–æ–≥–¥–∞?**: 
   - Load factor > 6.5 (–≤ —Å—Ä–µ–¥–Ω–µ–º –±–æ–ª—å—à–µ 6.5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –±–∞–∫–µ—Ç).
   - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ overflow-–±–∞–∫–µ—Ç–æ–≤.
2. **–ö–∞–∫?**: 
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ –±–∞–∫–µ—Ç–æ–≤ –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ ($B+1$).
   - **–õ–µ–Ω–∏–≤–∞—è —ç–≤–∞–∫—É–∞—Ü–∏—è**: –≠–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è —á–∞—Å—Ç—è–º–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–∞–¥–æ–ª–≥–æ.

---

# 2. üöÄ –ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (`map` Go 1.24+)

–ù–∞—á–∏–Ω–∞—è —Å Go 1.24, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏–∑–∞–π–Ω **Swiss Tables**. –≠—Ç–æ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∞–µ—Ç `map` –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

–í–º–µ—Å—Ç–æ –±–∞–∫–µ—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–ì—Ä—É–ø–ø—ã (Groups)** –∏ **Swiss Tables** –∞–ª–≥–æ—Ä–∏—Ç–º—ã.

- **hmap**: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≥—Ä—É–ø–ø.
- **–ì—Ä—É–ø–ø–∞ (group)**: –°–æ–¥–µ—Ä–∂–∏—Ç **8 —Å–ª–æ—Ç–æ–≤** –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ **Control word** (8 –±–∞–π—Ç).
- **Control word**: –•—Ä–∞–Ω–∏—Ç 7-–±–∏—Ç–Ω—ã–µ –æ—Ç–ø–µ—á–∞—Ç–∫–∏ —Ö–µ—à–µ–π (**H2**) –∏–ª–∏ —Å—Ç–∞—Ç—É—Å—ã —Å–ª–æ—Ç–æ–≤ (`empty`, `deleted`).

### –ü–æ—á–µ–º—É —ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ?

1. **SIMD**: Go –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –Ω—É–∂–Ω–æ–≥–æ —Ö–µ—à–∞ –≤–æ –≤—Å–µ–π –≥—Ä—É–ø–ø–µ (8 —Å–ª–æ—Ç–æ–≤) –∑–∞ **–æ–¥–Ω—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞**.
2. **–ö—ç—à-–ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å**: –ù–µ—Ç —Ü–µ–ø–æ—á–µ–∫ overflow-–±–∞–∫–µ—Ç–æ–≤. –î–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –ø–ª–æ—Ç–Ω–µ–µ –≤ –ø–∞–º—è—Ç–∏.
3. **–õ–∏–Ω–µ–π–Ω–æ–µ –ø—Ä–æ–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –ø–æ–ª–Ω–∞—è, –º—ã –ø—Ä–æ—Å—Ç–æ –∏–¥–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å–æ—Å–µ–¥–Ω–µ–π –≥—Ä—É–ø–ø–µ.

## –û–ø–µ—Ä–∞—Ü–∏–∏ –≤ Swiss Tables

### –ü–æ–∏—Å–∫
1. –•–µ—à —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **H1** (—É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≥—Ä—É–ø–ø—É) –∏ **H2** (7-–±–∏—Ç–Ω—ã–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫).
2. –° –ø–æ–º–æ—â—å—é **SIMD** –∏—â–µ–º **H2** –≤ `control word` –≥—Ä—É–ø–ø—ã.
3. –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∞–º –∫–ª—é—á.
4. –ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ —Å—Ç–∞—Ç—É—Å `empty` ‚Äî –∫–ª—é—á–∞ —Ç–æ—á–Ω–æ –Ω–µ—Ç.

### –£–¥–∞–ª–µ–Ω–∏–µ
–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø—Ä–æ—Å—Ç–æ –æ—á–∏—Å—Ç–∏—Ç—å —Å–ª–æ—Ç, –æ–Ω –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `deleted`. –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –ª–∏–Ω–µ–π–Ω–æ–≥–æ –ø—Ä–æ–±–∏—Ä–æ–≤–∞–Ω–∏—è, —á—Ç–æ–±—ã –ø–æ–∏—Å–∫ –Ω–µ –æ–±—Ä—ã–≤–∞–ª—Å—è —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–∞—è (–¥–æ 1.24) | Swiss Tables (1.24+) |
| :--- | :--- | :--- |
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∞** | –ë–∞–∫–µ—Ç—ã + Overflow buckets | –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã |
| **–ü–æ–∏—Å–∫** | –õ–∏–Ω–µ–π–Ω—ã–π –æ–±—Ö–æ–¥ –±–∞–∫–µ—Ç–∞ | **SIMD** –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø—ã |
| **–ö–æ–ª–ª–∏–∑–∏–∏** | –¶–µ–ø–æ—á–∫–∏ (chaining) | –õ–∏–Ω–µ–π–Ω–æ–µ –ø—Ä–æ–±–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –°—Ä–µ–¥–Ω—è—è | **+20-50%** –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞ |
| **–ü–∞–º—è—Ç—å** | –ë–æ–ª—å—à–µ (padding, overflow) | **-20-28%** –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è |

---

## üí° –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (API –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å)

```go
package main

import "fmt"

func main() {
    // –°–æ–∑–¥–∞–Ω–∏–µ
    m := make(map[string]int, 10) // 10 - –Ω–∞—á–∞–ª—å–Ω–∞—è –µ–º–∫–æ—Å—Ç—å

    // –ó–∞–ø–∏—Å—å
    m["Go"] = 2009

    // –ß—Ç–µ–Ω–∏–µ (–∑–∞–ø—è—Ç–∞—è-ok)
    val, ok := m["Go"]
    if ok {
        fmt.Println("Found:", val)
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ
    delete(m, "Go")
}
```
