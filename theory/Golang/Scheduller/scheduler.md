# üöÄ –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go

[‚Üê –ù–∞–∑–∞–¥ –≤ —Ç–µ–æ—Ä–∏—é Go](../)

> [!NOTE]
> –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö **–ù–∏–∫–æ–ª–∞—è –¢—É–∑–æ–≤–∞**. –≠—Ç–æ –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ ¬´—Å –Ω—É–ª—è¬ª, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ –ø–æ–Ω—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ *–∫–∞–∫* –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –∏ *–ø–æ—á–µ–º—É* –æ–Ω —É—Å—Ç—Ä–æ–µ–Ω –∏–º–µ–Ω–Ω–æ —Ç–∞–∫.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–í–≤–æ–¥–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ –∑–∞—á–µ–º —ç—Ç–æ –∑–Ω–∞—Ç—å](#–≤–≤–æ–¥–Ω—ã–µ-—Å–ª–æ–≤–∞)
2. [–ö—Ä–∞—Ç–∫–∏–π –ª–∏–∫–±–µ–∑ –ø–æ –æ—Å–Ω–æ–≤–∞–º](#–æ—Å–Ω–æ–≤—ã)
   - [–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞](#–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å)
   - [–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å vs –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º](#concurrency-vs-parallelism)
   - [–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–° –∏ —Ç—Ä–µ–¥—ã](#os-scheduler)
3. [–ê–Ω–∞—Ç–æ–º–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞](#context-switch)
   - [OS Threads vs Goroutines](#anatomy-comparison)
   - [–í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#perf-impact)
4. [–ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º —Å–≤–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫](#–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
   - [–ú–æ–¥–µ–ª—å 1:1](#model-1-1)
   - [–ü—É–ª —Ç—Ä–µ–¥–æ–≤](#thread-pool)
   - [–ú–æ–¥–µ–ª—å M:N](#model-m-n)
5. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ GMP](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-gmp)
   - [–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å (GRQ)](#grq)
   - [–õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ (LRQ)](#lrq)
6. [–ú–µ—Ö–∞–Ω–∏–∑–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
   - [Work Stealing](#work-stealing)
   - [Handoff](#handoff)
   - [Network Poller](#netpoller)
7. [–í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–∞–π–º–∏–Ω–≥–æ–≤](#preemption)
   - [Sysmon](#sysmon)
   - [Cooperative Preemption](#cooperative)
   - [–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ (Go 1.14+)](#forced)
8. [–ü—Ä–∞–∫—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞](#debug)

---

<a name="–≤–≤–æ–¥–Ω—ã–µ-—Å–ª–æ–≤–∞"></a>
## 1. –í–≤–æ–¥–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ –∑–∞—á–µ–º –∏–∑—É—á–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫?

–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π, –Ω–æ —Å–ª–æ–∂–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. Go —Å–¥–µ–ª–∞–ª –µ—ë –¥–æ—Å—Ç—É–ø–Ω–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç—Ä—ë–º —Å—Ç–æ–ª–ø–∞–º:
*   **–ì–æ—Ä—É—Ç–∏–Ω—ã** (–ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã)
*   **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** (–¥–∏—Ä–∏–∂—ë—Ä)
*   **–ö–∞–Ω–∞–ª—ã** (–º–µ—Ö–∞–Ω–∏–∑–º –æ–±—â–µ–Ω–∏—è)

> [!TIP]
> –°—Ç–∞—Ç—å—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ –≤—ã —É–∂–µ –∑–Ω–∞–∫–æ–º—ã —Å –æ—Å–Ω–æ–≤–∞–º–∏ Go (Tour of Go) –∏ –±–∞–∑–æ–≤—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º –≥–æ—Ä—É—Ç–∏–Ω. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ-–≤–µ—Ä—Å–∏—é —Å –∂–∏–≤—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤ `goschedviz`, –∑–∞–≥–ª—è–Ω–∏—Ç–µ [—Å—é–¥–∞](https://youtu.be/ZTJcaP4G4JM).

---

<a name="–æ—Å–Ω–æ–≤—ã"></a>
## 2. –ö—Ä–∞—Ç–∫–∏–π –ª–∏–∫–±–µ–∑ –ø–æ –æ—Å–Ω–æ–≤–∞–º

<a name="–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å"></a>
### üß© –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

–ö–æ–º–ø—å—é—Ç–µ—Ä –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞. –û–¥–Ω–∞–∫–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π CPU –Ω–∞—Å—Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä, —á—Ç–æ –¥–∞–∂–µ –Ω–∞ –æ–¥–Ω–æ–º —è–¥—Ä–µ –æ–Ω —Å–æ–∑–¥–∞–µ—Ç –∏–ª–ª—é–∑–∏—é –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏, –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—è—Å—å –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

![–û–¥–Ω–æ—è–¥–µ—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ª–∏—à—å –æ–¥–Ω—É –∑–∞–¥–∞—á—É, –Ω–æ –Ω–∞–º –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –º–Ω–æ–≥–æ.](img/image_3.png)

<a name="concurrency-vs-parallelism"></a>
### ‚öñÔ∏è –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å vs –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º

–≠—Ç–æ –¥–≤–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–Ω—è—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ –ø—É—Ç–∞—é—Ç:

*   **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å (Concurrency)** ‚Äî —ç—Ç–æ **–¥–∏–∑–∞–π–Ω**. –í–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —á–∞—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ *–º–æ–≥—É—Ç* –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –ª—é–±–æ–º –ø–æ—Ä—è–¥–∫–µ.
*   **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (Parallelism)** ‚Äî —ç—Ç–æ **–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ**. –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ (—Ç—Ä–µ–±—É–µ—Ç >1 —è–¥—Ä–∞).

> [!IMPORTANT]
> **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –º—ã *—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ–º* —Ä–∞–±–æ—Ç—É —Å–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –≤–µ—â–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
> **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º** ‚Äî –∫–æ–≥–¥–∞ –º—ã *—Ñ–∏–∑–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º* –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–µ—â–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

<a name="os-scheduler"></a>
### üö¶ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–° –∏ —Ç—Ä–µ–¥—ã

–ù–∞ —É—Ä–æ–≤–Ω–µ –û–° –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —É–ø—Ä–∞–≤–ª—è–µ—Ç **Kernel Scheduler**. –û–Ω –æ–ø–µ—Ä–∏—Ä—É–µ—Ç **—Ç—Ä–µ–¥–∞–º–∏ (–ø–æ—Ç–æ–∫–∞–º–∏)**.
–¢—Ä–µ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –æ–¥–Ω–æ–º –∏–∑ —Ç—Ä—ë—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:
1.  **Executing**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —è–¥—Ä–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.
2.  **Runnable**: –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ, –∂–¥—ë—Ç —Å–≤–æ–µ–π –æ—á–µ—Ä–µ–¥–∏.
3.  **Waiting**: –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (I/O, —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤, –º—å—é—Ç–µ–∫—Å).

---

<a name="context-switch"></a>
## 3. –ê–Ω–∞—Ç–æ–º–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

<a name="anatomy-comparison"></a>
### üîç OS Threads vs Goroutines

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (Context Switching) ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–æ–≤–æ–π. 

#### **Kernel-level Context Switch (–ü–æ—Ç–æ–∫–∏ –û–°)** ‚Äî üõë **–î–æ—Ä–æ–≥–æ**
–ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–° –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ø–æ—Ç–æ–∫–∏, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ¬´—Ç—è–∂–µ–ª–∞—è¬ª –æ–ø–µ—Ä–∞—Ü–∏—è:
1.  **User ‚Üí Kernel Mode**: –î–æ—Ä–æ–≥–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤.
2.  **Full State Save**: –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è **–≤—Å–µ** —Ä–µ–≥–∏—Å—Ç—Ä—ã (RAX, XMM, AVX, FPU –∏ –¥—Ä.) ‚Äî —ç—Ç–æ –∫–∏–ª–æ–±–∞–π—Ç—ã –¥–∞–Ω–Ω—ã—Ö.
3.  **TLB Flush**: –°–±—Ä–æ—Å –∫—ç—à–∞ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü (–µ—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏).
4.  **Cache Pollution**: –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ ¬´–≤—ã–º—ã–≤–∞—é—Ç¬ª —Å—Ç–∞—Ä—ã–µ –∏–∑ L1/L2/L3 –∫—ç—à–µ–π.
*‚è± –í—Ä–µ–º—è: ~1-10 –º–∫—Å.*

#### **User-space Context Switch (–ì–æ—Ä—É—Ç–∏–Ω—ã Go)** ‚Äî üöÄ **–î–µ—à–µ–≤–æ**
–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1.  **Minimal State**: –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ–≥–æ **3 —Ä–µ–≥–∏—Å—Ç—Ä–∞** (PC, SP, BP).
2.  **No Kernel Mode**: –ù–∏–∫–∞–∫–∏—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –≤ —Ä–µ–∂–∏–º —è–¥—Ä–∞.
3.  **No TLB Flush**: –í—Å–µ –≥–æ—Ä—É—Ç–∏–Ω—ã –∂–∏–≤—É—Ç –≤ –æ–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞.
4.  **Cache Locality**: –†–∞–Ω—Ç–∞–π–º —Å—Ç–∞—Ä–∞–µ—Ç—Å—è —Å–æ–±–ª—é–¥–∞—Ç—å CPU Affinity.
*‚è± –í—Ä–µ–º—è: ~10-50 –Ω—Å (–≤ 100-1000 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ).*

<a name="perf-impact"></a>
### üìà –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ß–µ–º –±–æ–ª—å—à–µ ¬´–≥–æ—Ç–æ–≤—ã—Ö¬ª (Runnable) —Ç—Ä–µ–¥–æ–≤, —Ç–µ–º —á–∞—â–µ –û–° –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∏—Ö –º–µ–Ω—è—Ç—å. –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä —Ç—Ä–∞—Ç–∏—Ç –Ω–∞ –Ω–∏—Ö –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º –Ω–∞ —Å–∞–º—É –ø–æ–ª–µ–∑–Ω—É—é —Ä–∞–±–æ—Ç—É.

![–î–≤–∞ –ø—Ä–∏–º–µ—Ä–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞](img/image_6.png)

–í–æ-–≤—Ç–æ—Ä—ã—Ö, –∫–∞–∂–¥—ã–π —Ç—Ä–µ–¥ –æ—Ç—ä–µ–¥–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—É—é —á–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ –Ω–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞: —Å—Ç–µ–∫ –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–¥–∞ —á–∞—Å—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ –ø–∞—Ä—ã –º–µ–≥–∞–±–∞–π—Ç (–≤ –Ω—ë–º —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π –∏ –¥—Ä.)

–¢–µ–ø–µ—Ä—å, –∑–Ω–∞—è —á—Ç–æ —Ç—Ä–µ–¥—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ—Ä–æ–≥–∏–µ, –º—ã –ø—Ä–∏—Ö–æ–¥–∏–º –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é —Ç–æ–≥–æ, —á—Ç–æ —Ö–æ—Ç–∏–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏—Ö –∫–∞–∫ –º–æ–∂–Ω–æ –º–µ–Ω—å—à–µ. –ß–µ–º –º–µ–Ω—å—à–µ —Ç—Ä–µ–¥–æ–≤, —Ç–µ–º —Ä–µ–∂–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Ç–µ–º –º–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏ –º—ã —Ç—Ä–∞—Ç–∏–º. –≠—Ç–æ –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –º—ã –≤ –±—É–¥—É—â–µ–º –±—É–¥–µ–º —Å—Å—ã–ª–∞—Ç—å—Å—è –æ—á–µ–Ω—å —á–∞—Å—Ç–æ.

–î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –Ω–∞–º —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –Ω–æ –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –≥–ª—É–±–∂–µ, —Ç–æ —É –º–µ–Ω—è –µ—Å—Ç—å –±–æ–ª–µ–µ¬†[–ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–æ—Å—Ç](https://t.me/ntuzov/410)¬†–Ω–∞ —Ç–µ–º—É —Ç—Ä–µ–¥–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

<a name="–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"></a>
## 4. –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º —Å–≤–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫: –ü—É—Ç—å –æ—Ç 1:1 –¥–æ M:N

–ò—Ç–∞–∫, –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ –º—ã –¥–æ–±—Ä–∞–ª–∏—Å—å –¥–æ —Å–∞–º–æ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –º—ã ‚Äî –∏–Ω–∂–µ–Ω–µ—Ä—ã Go Team. –ù–∞—à–∞ –∑–∞–¥–∞—á–∞: –Ω–∞—É—á–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ Go –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏. –î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–∫–æ–π –∫–æ–¥:

```go
func main() {
    task1() // –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏ –∂–¥—ë–º –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    task2() // –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é
}
```

–§—É–Ω–∫—Ü–∏–∏ `task1` –∏ `task2` –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**. –ê –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã `task2` –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—å –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `task1`, —Ç–æ –µ—Å—Ç—å **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**. –í Go —ç—Ç–æ —Ä–µ—à–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ `go`:

```go
func main() {
    go task1() 
    go task2()
}
```

–ß—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏–º–∏ –≤—ã–∑–æ–≤–∞–º–∏, –Ω–∞–º –Ω—É–∂–µ–Ω **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (Scheduler)**. –ú—ã —É–∂–µ –∑–Ω–∞–µ–º, —á—Ç–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–° —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–µ–¥–∞–º–∏. –î–∞–≤–∞–π—Ç–µ ¬´—Å–≤–æ—Ä—É–µ–º¬ª —ç—Ç—É –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –∏ –Ω–∞–∑–æ–≤–µ–º —Å–≤–æ–∏ –∞–Ω–∞–ª–æ–≥–∏ ‚Äî **–≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏ (goroutines)**. –≠—Ç–æ —Ç–µ –∂–µ —Å–∞–º—ã–µ –ø–æ—Ç–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–æ –∂–∏–≤—É—â–∏–µ –≤–Ω—É—Ç—Ä–∏ –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã (–≤ User Space).

> [!NOTE]
> –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç—Ä–µ–¥–æ–≤, –¥–µ–ª–∞—è –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∏ –¥–µ—à–µ–≤—ã–º –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

<a name="model-1-1"></a>
### üìã –ú–æ–¥–µ–ª—å 1:1 (–ü—Ä—è–º–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ)

–°–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –Ω–∞ –∫–∞–∂–¥—É—é –≥–æ—Ä—É—Ç–∏–Ω—É —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–¥–∏–Ω —Å–∏—Å—Ç–µ–º–Ω—ã–π —Ç—Ä–µ–¥.

![–ú–æ–¥–µ–ª—å 1:1 ‚Äî –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π —Ç—Ä–µ–¥](img/image_9.png)

*   **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ú—ã –ø–µ—Ä–µ–¥–∞–µ–º –≥–æ—Ä—É—Ç–∏–Ω—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫—É, –æ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –û–° –Ω–æ–≤—ã–π —Ç—Ä–µ–¥, –∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã ‚Äî —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç –µ–≥–æ.
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–∞–∫ –º—ã –≤—ã—è—Å–Ω–∏–ª–∏ –≤ [—Ä–∞–∑–¥–µ–ª–µ –ø—Ä–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç](#context-switch), —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–Ω–∏—á—Ç–æ–∂–∞—Ç—å —Ç—Ä–µ–¥—ã ‚Äî —ç—Ç–æ –±–µ–∑—É–º–Ω–æ –¥–æ—Ä–æ–≥–æ. –¢—ã—Å—è—á–∞ –≥–æ—Ä—É—Ç–∏–Ω = —Ç—ã—Å—è—á–∞ —Ç—Ä–µ–¥–æ–≤ = –≥–∏–≥–∞–±–∞–π—Ç—ã –ø–∞–º—è—Ç–∏ –Ω–∞ —Å—Ç–µ–∫–∏.

<a name="thread-pool"></a>
### üèä –ü—É–ª —Ç—Ä–µ–¥–æ–≤ (Thread Pool)

–î–∞–≤–∞–π—Ç–µ –Ω–µ –±—É–¥–µ–º —É–Ω–∏—á—Ç–æ–∂–∞—Ç—å —Ç—Ä–µ–¥—ã, –∞ –±—É–¥–µ–º –∏—Ö –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

![–ü—É–ª —Ç—Ä–µ–¥–æ–≤: –≤–æ–∑–≤—Ä–∞—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ç—Ä–µ–¥–∞ –≤ –æ–±—â—É—é –∫—É—á—É](img/image_11.png)

–≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ, –Ω–æ –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É **–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞**. –û–° –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç ¬´–∑–∞–¥—ã—Ö–∞—Ç—å—Å—è¬ª –æ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –µ—Å–ª–∏ –º—ã –∑–∞–ø—É—Å—Ç–∏–º –º–∏–ª–ª–∏–æ–Ω –≥–æ—Ä—É—Ç–∏–Ω.

<a name="model-m-n"></a>
### üèóÔ∏è –ú–æ–¥–µ–ª—å M:N (–ú–Ω–æ–≥–æ –Ω–∞ –ú–Ω–æ–≥–æ)

–ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å —Ä–æ–∂–¥–∞–µ—Ç—Å—è –º–∞–≥–∏—è. –ú—ã –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç—Ä–µ–¥–æ–≤ (–æ–±—ã—á–Ω–æ –ø–æ —á–∏—Å–ª—É —è–¥–µ—Ä CPU), –∞ –º–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ–∂–¥—É –Ω–∏–º–∏.

---

<a name="–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-gmp"></a>
## 5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ GMP: –¢—Ä–∏ –∫–∏—Ç–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

–ß—Ç–æ–±—ã –º–æ–¥–µ–ª—å M:N —Ä–∞–±–æ—Ç–∞–ª–∞, –≤ Go –≤–≤–µ–ª–∏ —Ç—Ä–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–∞–∫ –º–æ–¥–µ–ª—å **GMP**:

<a name="g-struct"></a>
### üü¢ G (Goroutine)
–ù–∞ —É—Ä–æ–≤–Ω–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ —Ä–∞–Ω—Ç–∞–π–º–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `G` (–æ–±—ä—è–≤–ª–µ–Ω–∞ –≤ `runtime/runtime2.go`), –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- **stack**: –£–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏.
- **sched**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ (**PC, SP, BP**), –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- **status**: –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã.

> [!IMPORTANT]
> **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–µ–∫–æ–º**: –ì–æ—Ä—É—Ç–∏–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤—Å–µ–≥–æ —Å **2 –ö–ë**. –ï—Å–ª–∏ –º–µ—Å—Ç–∞ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `runtime.morestack`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–µ–ª—è–µ—Ç –Ω–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç –ø–∞–º—è—Ç–∏ (–æ–±—ã—á–Ω–æ –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

#### **–°–æ—Å—Ç–æ—è–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω—ã –≤ —Ä–∞–Ω—Ç–∞–π–º–µ:**
- **Waiting** (`_Gwaiting`) ‚Äî –∂–¥—ë—Ç (–∫–∞–Ω–∞–ª–∞, –º—å—é—Ç–µ–∫—Å–∞, —Å–µ—Ç–∏).
- **Runnable** (`_Grunnable`) ‚Äî –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É –≤ –æ—á–µ—Ä–µ–¥–∏.
- **Executing** (`_Grunning`) ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —Ç—Ä–µ–¥–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.
- **_Gsyscall** ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤.
- **_Gdead** ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞.

![–ì–æ—Ä—É—Ç–∏–Ω—ã –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è](img/image_7.png)

<a name="p-struct"></a>
### üÜî P (Processor)
–≠—Ç–æ ¬´–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä¬ª –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –ò–º–µ–Ω–Ω–æ `P` –≤–ª–∞–¥–µ–µ—Ç –æ—á–µ—Ä–µ–¥—è–º–∏ –≥–æ—Ä—É—Ç–∏–Ω. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ `P` –æ–±—ã—á–Ω–æ —Ä–∞–≤–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —è–¥–µ—Ä CPU (`runtime.GOMAXPROCS`).

<a name="m-struct"></a>
### üßµ M (Machine/Thread)
–≠—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –û–°. –ß—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥, —Ç—Ä–µ–¥ `M` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ `P`.

![–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –±–µ—Ä—ë—Ç –≥–æ—Ä—É—Ç–∏–Ω—É –∏ –∫–ª–∞–¥—ë—Ç –µ—ë –≤ –ú–∞—à–∏–Ω—É –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è](img/image_8.png)

---

<a name="–æ—á–µ—Ä–µ–¥–∏"></a>
### üß± –û—á–µ—Ä–µ–¥–∏: –ì–¥–µ –∂–∏–≤—É—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã?

<a name="grq"></a>
#### **1. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å (GRQ)**
–ó–¥–µ—Å—å –ª–µ–∂–∞—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—É. 
*   **–ü—Ä–æ–±–ª–µ–º–∞**: –ö GRQ –Ω—É–∂–µ–Ω **–º—å—é—Ç–µ–∫—Å**. –ï—Å–ª–∏ –±—ã –≤—Å–µ —è–¥—Ä–∞ –ª–µ–∑–ª–∏ —Ç—É–¥–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, –æ–Ω–∏ –±—ã –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–∞—Ç–∏–ª–∏ –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, —á–µ–º –Ω–∞ —Ä–∞–±–æ—Ç—É.

![–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ GRQ –º—å—é—Ç–µ–∫—Å–æ–º](img/image_17.png)

<a name="lrq"></a>
#### **2. –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ (LRQ)**
–ö–∞–∂–¥—ã–π `P` –∏–º–µ–µ—Ç —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –Ω–∞ **256** –≥–æ—Ä—É—Ç–∏–Ω. –¢—Ä–µ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–µ–π –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, —á—Ç–æ –¥–∞–µ—Ç –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏.

---

<a name="–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏"></a>
## 6. –ú–µ—Ö–∞–Ω–∏–∑–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

<a name="work-stealing"></a>
### üïµÔ∏è Work Stealing (–ö—Ä–∞–∂–∞ —Ä–∞–±–æ—Ç—ã)

–ß—Ç–æ –µ—Å–ª–∏ –æ–¥–∏–Ω `P` –∑–∞–∫–æ–Ω—á–∏–ª –≤—Å–µ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏, –∞ —É —Å–æ—Å–µ–¥–∞ –∏—Ö –µ—â–µ —Å–æ—Ç–Ω—è? 
**–ê–ª–≥–æ—Ä–∏—Ç–º –±–µ–∑—Ä–∞–±–æ—Ç–Ω–æ–≥–æ P**:
1. 1/61 —Ä–∞–∑ –∑–∞–≥–ª—è–Ω—É—Ç—å –≤ GRQ.
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é LRQ.
3. –ü—ã—Ç–∞—Ç—å—Å—è **—É–∫—Ä–∞—Å—Ç—å –ø–æ–ª–æ–≤–∏–Ω—É** –∑–∞–¥–∞—á —É —Å–æ—Å–µ–¥–∞.

![Work Stealing –≤ –¥–µ–π—Å—Ç–≤–∏–∏](img/image_20.png)

<a name="handoff"></a>
### ü§ù Handoff (–ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ–ª–Ω–æ–º–æ—á–∏–π)

–ï—Å–ª–∏ –≥–æ—Ä—É—Ç–∏–Ω–∞ –¥–µ–ª–∞–µ—Ç **–±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞), –æ–Ω–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ—Å—å —Ç—Ä–µ–¥ `M`.
**–†–µ—à–µ–Ω–∏–µ**: –†–∞–Ω—Ç–∞–π–º –æ—Ç—Ü–µ–ø–ª—è–µ—Ç `P` –æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ `M` –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –µ–≥–æ –Ω–∞ –Ω–æ–≤—ã–π (–∏–ª–∏ —Å–≤–æ–±–æ–¥–Ω—ã–π –∏–∑ –ø—É–ª–∞) —Ç—Ä–µ–¥. –ö–æ–≥–¥–∞ syscall –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, `M` –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–±—Ä–∞—Ç—å `P` –Ω–∞–∑–∞–¥ –∏–ª–∏ –æ—Ç–¥–∞—Å—Ç –≥–æ—Ä—É—Ç–∏–Ω—É –≤ GRQ –∏ —É—Å–Ω–µ—Ç.

![Handoff: –ø–µ—Ä–µ–Ω–æ—Å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –Ω–∞ –Ω–æ–≤—ã–π —Ç—Ä–µ–¥](img/image_22.png)

<a name="netpoller"></a>
### üåê Network Poller (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π I/O)

–î–ª—è —Å–µ—Ç–µ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤ Go –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç—Ä–µ–¥. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `epoll` (Linux) –∏–ª–∏ `kqueue` (MacOS).
> [!TIP]
> **–ê–Ω–∞–ª–æ–≥–∏—è**: Syscall ‚Äî —ç—Ç–æ –∫–∞–∫ –∑–≤–æ–Ω–æ–∫ –∫–æ–ª–ª–µ–≥–µ (–≤—ã –∂–¥–µ—Ç–µ –Ω–∞ –ø—Ä–æ–≤–æ–¥–µ). Netpoller ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ (–≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∏ –ø–æ—à–ª–∏ –¥–µ–ª–∞—Ç—å –¥—Ä—É–≥–∏–µ –¥–µ–ª–∞, –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–¥–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ).

![–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π syscall —á–µ—Ä–µ–∑ Netpoller](img/image_24.png)

---

<a name="preemption"></a>
## 7. –í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –∏ Sysmon

<a name="sysmon"></a>
### üëÅÔ∏è Sysmon (–°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä)
–≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç—Ä–µ–¥, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –≤ —Ñ–æ–Ω–µ –±–µ–∑ `P`. –û–Ω:
*   –ó–∞–ø—É—Å–∫–∞–µ—Ç Netpoller.
*   –î–µ–ª–∞–µ—Ç **Handoff** –¥–ª—è syscall-–æ–≤, –¥–ª—è—â–∏—Ö—Å—è –±–æ–ª–µ–µ 10 –º—Å.
*   –ü–æ–º–µ—á–∞–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è.

<a name="forced"></a>
### üõ°Ô∏è –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ (Go 1.14+)
–î–æ –≤–µ—Ä—Å–∏–∏ 1.14 –≥–æ—Ä—É—Ç–∏–Ω–∞ –º–æ–≥–ª–∞ ¬´–∑–∞—Ö–≤–∞—Ç–∏—Ç—å¬ª –ø–æ—Ç–æ–∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Ü–∏–∫–ª–æ–º –±–µ–∑ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π. –¢–µ–ø–µ—Ä—å —Ä–∞–Ω—Ç–∞–π–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –û–° (`SIGURG`), —á—Ç–æ–±—ã –ø—Ä–µ—Ä—ã–≤–∞—Ç—å —Ç–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∫–∞–∂–¥—ã–µ 10 –º—Å.

---

<a name="debug"></a>
## 8. –ü—Ä–∞–∫—Ç–∏–∫–∞ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—Ç–ª–∞–¥–∫–∏

### üõ† –ö–∞–∫ –Ω–µ ¬´–≤—ã—Å—Ç—Ä–µ–ª–∏—Ç—å –≤ –Ω–æ–≥—É¬ª?

1.  **–£—Ç–µ—á–∫–∏ –≥–æ—Ä—É—Ç–∏–Ω**: –ï—Å–ª–∏ –≥–æ—Ä—É—Ç–∏–Ω–∞ –≤–∏—Å–∏—Ç –≤ `Wait` –≤–µ—á–Ω–æ ‚Äî —ç—Ç–æ —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `context.Context`.
2.  **–ó–∞—Ö–≤–∞—Ç –ø–æ—Ç–æ–∫–∞**: –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö `CGO` –≤—ã–∑–æ–≤–æ–≤ –ø–æ—Ä–æ–¥–∏—Ç —Ç—ã—Å—è—á–∏ —Ç—Ä–µ–¥–æ–≤ –û–° –∏–∑-–∑–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ handoff.

### üìä –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
*   **`GODEBUG=schedtrace=1000`**: –î–∞–º–ø —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.
*   **`pprof`**: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π (`/debug/pprof/goroutine?debug=1`).
*   **`runtime.NumGoroutine()`**: –û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ G.

---

## üéØ –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go ‚Äî —ç—Ç–æ —à–µ–¥–µ–≤—Ä, —Å–æ—á–µ—Ç–∞—é—â–∏–π –ø—Ä–æ—Å—Ç–æ—Ç—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.

![–û–±—â–∞—è —Å—Ö–µ–º–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ Go](img/image_30.png)

> [!TIP]
> –ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–∞–±–æ—Ç—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –≤–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ [goschedviz](https://github.com/JustSkiv/goschedviz).
