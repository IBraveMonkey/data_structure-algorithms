# üìè –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (Alignment) –∏ Padding –≤ Go

## 1. üß© –ß—Ç–æ —Ç–∞–∫–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ (Alignment)

**–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ** ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏, —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ—Ç–æ—Ä–æ–º—É –∑–Ω–∞—á–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –∞–¥—Ä–µ—Å–∞, –∫—Ä–∞—Ç–Ω–æ–≥–æ –µ–≥–æ **alignment**.

**–ü—Ä–∏–º–µ—Ä:**
- `int32` –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –∞–¥—Ä–µ—Å–∞, –∫—Ä–∞—Ç–Ω–æ–≥–æ **4**.
- `int64` ‚Äî –∫—Ä–∞—Ç–Ω–æ–≥–æ **8**.

> [!NOTE]
> –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω–æ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã.

## 2. ‚ùì –ó–∞—á–µ–º –Ω—É–∂–Ω–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ

### 2.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä —á–∏—Ç–∞–µ—Ç –ø–∞–º—è—Ç—å –Ω–µ –ø–æ–±–∞–π—Ç–æ–≤–æ, –∞ –±–ª–æ–∫–∞–º–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (—Å–ª–æ–≤–∞–º–∏). –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è **–æ–¥–Ω–æ —á—Ç–µ–Ω–∏–µ** –ø–∞–º—è—Ç–∏. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—É –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–π –∏ ¬´—Å–∫–ª–µ–∏–≤–∞—Ç—å¬ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —á—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É.

### 2.2 –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
–î–ª—è –º–Ω–æ–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø–∞–∫–µ—Ç `sync/atomic`) —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã –ø–æ –∏—Ö —Ä–∞–∑–º–µ—Ä—É. –ù–∞ 32-–±–∏—Ç–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Ö –Ω–µ–≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–π `int64` –≤—ã–∑–æ–≤–µ—Ç –ø–∞–Ω–∏–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
## 3. üß± –ß—Ç–æ —Ç–∞–∫–æ–µ Padding

**Padding** ‚Äî —ç—Ç–æ –ø—É—Å—Ç—ã–µ –±–∞–π—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ–∂–¥—É –ø–æ–ª—è–º–∏ –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —á—Ç–æ–±—ã —Å–æ–±–ª—é—Å—Ç–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è.

## 4. üî¢ –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ (64-bit)

| –¢–∏–ø | –†–∞–∑–º–µ—Ä (–±–∞–π—Ç) | Alignment |
| :--- | :---: | :---: |
| `bool`, `int8`, `uint8` | 1 | 1 |
| `int16`, `uint16` | 2 | 2 |
| `int32`, `uint32`, `float32` | 4 | 4 |
| `int64`, `uint64`, `float64`, `pointer` | 8 | 8 |
| `string` (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑ 2 –ø–æ–ª–µ–π) | 16 | 8 |
| `slice` (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑ 3 –ø–æ–ª–µ–π) | 24 | 8 |

> [!TIP]
> –†–∞–∑–º–µ—Ä —Ç–∏–ø–∞ –∏ –µ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –≤–µ—â–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, `string` –∑–∞–Ω–∏–º–∞–µ—Ç 16 –±–∞–π—Ç, –Ω–æ –µ–≥–æ **alignment** —Ä–∞–≤–µ–Ω 8, —Ç–∞–∫ –∫–∞–∫ —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –ø–æ–ª–µ –≤–Ω—É—Ç—Ä–∏ (—É–∫–∞–∑–∞—Ç–µ–ª—å) —Ç—Ä–µ–±—É–µ—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–æ 8 –±–∞–π—Ç–∞–º.
## 5. üè¢ –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä (struct)

### 5.1 –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ
–ö–∞–∂–¥–æ–µ –ø–æ–ª–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –∞–¥—Ä–µ—Å–∞, –∫—Ä–∞—Ç–Ω–æ–≥–æ –µ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º—É **alignment**. –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–µ–Ω –µ—ë –æ–±—â–µ–º—É **alignment** (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –ø–æ–ª–µ–π).

### 5.2 –ü—Ä–∏–º–µ—Ä: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
```go
type Bad struct {
    a bool  // 1 –±–∞–π—Ç
            // [7 –±–∞–π—Ç padding]
    b int64 // 8 –±–∞–π—Ç
} // –ò—Ç–æ–≥–æ: 16 –±–∞–π—Ç
```
**–ü–∞–º—è—Ç—å:** `[a][p][p][p][p][p][p][p] [b][b][b][b][b][b][b][b]`

### 5.3 –ü—Ä–∏–º–µ—Ä: –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
```go
type Good struct {
    b int64 // 8 –±–∞–π—Ç
    a bool  // 1 –±–∞–π—Ç
            // [7 –±–∞–π—Ç padding –≤ –∫–æ–Ω—Ü–µ]
} // –ò—Ç–æ–≥–æ: 16 –±–∞–π—Ç
```
**–ü–∞–º—è—Ç—å:** `[b][b][b][b][b][b][b][b] [a][p][p][p][p][p][p][p]`

> [!TIP]
> **–ü–æ—á–µ–º—É –æ–±–∞ –ø—Ä–∏–º–µ—Ä–∞ –ø–æ 16 –±–∞–π—Ç?**
> –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–µ–Ω –µ—ë –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—é (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ **8** –¥–ª—è `int64`).
> –í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö `8 + 1 = 9`, –∞ –±–ª–∏–∂–∞–π—à–µ–µ —á–∏—Å–ª–æ, –∫—Ä–∞—Ç–Ω–æ–µ 8 ‚Äî —ç—Ç–æ **16**.
>
> **–ü–æ—á–µ–º—É `Good` –ª—É—á—à–µ?**
> –í `Good` –ø—É—Å—Ç—ã–µ –±–∞–π—Ç—ã (padding) —Å–æ–±—Ä–∞–Ω—ã –≤ –∫–æ–Ω—Ü–µ. –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–Ω–æ –ø–æ–ª–µ `c bool`, –æ–Ω–æ –∑–∞–π–º–µ—Ç –º–µ—Å—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ padding:
> - `Good` + `c bool` = **16 –±–∞–π—Ç**
> - `Bad` + `c bool` (–≤ –∫–æ–Ω—Ü–µ) = **24 –±–∞–π—Ç**

> [!IMPORTANT]
> **–ü—Ä–∞–≤–∏–ª–æ –±–æ–ª—å—à–æ–≥–æ –ø–∞–ª—å—Ü–∞**: –†–∞—Å–ø–æ–ª–∞–≥–∞–π—Ç–µ –ø–æ–ª—è –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è –∏—Ö —Ä–∞–∑–º–µ—Ä–∞. –≠—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Å—Ç–∞–≤–ª—è–µ–º–æ–≥–æ **padding**.
## 6. üöÄ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ–º—ã

### 6.1 Zero-sized types (–ü—É—Å—Ç—ã–µ —Ç–∏–ø—ã)
–¢–∏–ø—ã `struct{}` –∏ `[0]int` –∏–º–µ—é—Ç —Ä–∞–∑–º–µ—Ä **0**. –û–¥–Ω–∞–∫–æ —É –Ω–∏—Ö –µ—Å—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö:

```go
type S1 struct {
    a struct{}
    b int64
} // Size: 8, 'a' –Ω–µ –∑–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–∞

type S2 struct {
    a int64
    b struct{}
} // Size: 16! (Padding –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω—Ü–µ)
```

> [!WARNING]
> –ï—Å–ª–∏ –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ —è–≤–ª—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ–¥–Ω–∏–º** –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç **padding**, —á—Ç–æ–±—ã –∞–¥—Ä–µ—Å —ç—Ç–æ–≥–æ –ø–æ–ª—è –Ω–µ —É–∫–∞–∑—ã–≤–∞–ª –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –æ–±—ä–µ–∫—Ç –≤ –ø–∞–º—è—Ç–∏ (—ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã GC).

### 6.2 Cache Line –∏ False Sharing
–ü–∞–º—è—Ç—å —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ RAM –≤ –∫—ç—à –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –±–ª–æ–∫–∞–º–∏ –ø–æ **64 –±–∞–π—Ç–∞** (**Cache Line**). 
- –ï—Å–ª–∏ –¥–≤–µ –≥–æ—Ä—É—Ç–∏–Ω—ã —á–∞—Å—Ç–æ –ø–∏—à—É—Ç –≤ —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è –æ–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ø–∞–ª–∏ –≤ –æ–¥–Ω—É –∫—ç—à-–ª–∏–Ω–∏—é, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –±—É–¥–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –∫—ç—à. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **False Sharing**.
- –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å ¬´–ø—É—Å—Ç—ã–µ¬ª –ø–æ–ª—è (padding), —á—Ç–æ–±—ã —Ä–∞–∑–Ω–µ—Å—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —Ä–∞–∑–Ω—ã–º –∫—ç—à-–ª–∏–Ω–∏—è–º.

### 6.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `unsafe`
```go
import "unsafe"

fmt.Println(unsafe.Sizeof(s))   // –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä
fmt.Println(unsafe.Alignof(s))  // –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
fmt.Println(unsafe.Offsetof(s.b)) // –°–º–µ—â–µ–Ω–∏–µ –ø–æ–ª—è 'b' –æ—Ç –Ω–∞—á–∞–ª–∞
```

---

## üéØ –ò—Ç–æ–≥: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
1. **–ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—è**: –æ—Ç –±–æ–ª—å—à–∏—Ö –∫ –º–∞–ª—ã–º (`int64` -> `int32` -> `bool`).
2. **–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ö–≤–æ—Å—Ç–æ–º**: –Ω–µ —Å—Ç–∞–≤—å—Ç–µ `struct{}` –ø–æ—Å–ª–µ–¥–Ω–∏–º –ø–æ–ª–µ–º, –µ—Å–ª–∏ –≤–∞–∂–µ–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä.
3. **–ê—Ç–æ–º–∏–∫–∏**: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è `sync/atomic` –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã –ø–æ 8 –±–∞–π—Ç.
4. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∏–Ω—Ç–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `fieldalignment`), —á—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –ª–∏—à–Ω–∏–π padding.