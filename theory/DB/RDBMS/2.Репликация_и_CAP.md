# üëØ 2. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ CAP-—Ç–µ–æ—Ä–µ–º–∞

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–†–µ–ø–ª–∏–∫–∞—Ü–∏—è (Replication)](#—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è-replication)
2. [Sync vs Async](#sync-vs-async)
3. [CAP-—Ç–µ–æ—Ä–µ–º–∞](#cap-—Ç–µ–æ—Ä–µ–º–∞)
4. [Trade-off: –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å?](#trade-off-—á—Ç–æ-–≤—ã–±—Ä–∞—Ç—å)

---

## 1. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è (Replication)

**–†–µ–ø–ª–∏–∫–∞—Ü–∏—è** ‚Äî —ç—Ç–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –¥—Ä—É–≥–æ–π (–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥—Ä—É–≥–∏—Ö) –¥–ª—è:
1.  **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏** (—É–ø–∞–ª –æ–¥–∏–Ω ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –¥—Ä—É–≥–æ–π).
2.  **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ —á—Ç–µ–Ω–∏—è** (–æ–¥–∏–Ω –ø–∏—à–µ—Ç, –ø—è—Ç–µ—Ä–æ —á–∏—Ç–∞—é—Ç).

### Master-Slave (Leader-Follower)
–°–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è —Å—Ö–µ–º–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Postgres, MySQL, Redis).

```mermaid
graph TD
    UserWrite[–ó–∞–ø–∏—Å—å] --> Master[(Master / Leader)]
    Master -- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è --> Slave1[(Slave / Follower)]
    Master -- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è --> Slave2[(Slave / Follower)]
    UserRead1[–ß—Ç–µ–Ω–∏–µ] --> Slave1
    UserRead2[–ß—Ç–µ–Ω–∏–µ] --> Slave2
```

-   **–í—Å–µ –∑–∞–ø–∏—Å–∏** –∏–¥—É—Ç —Ç–æ–ª—å–∫–æ –≤ **Master**.
-   **–ß—Ç–µ–Ω–∏–µ** –º–æ–∂–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ **Slaves**.

---

## 2. Sync vs Async

–ö–∞–∫ –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç —Å –ú–∞—Å—Ç–µ—Ä–∞ –Ω–∞ –°–ª–µ–π–≤?

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (Async) ‚Äî *–ë—ã—Å—Ç—Ä–æ, –Ω–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ*
1.  –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –≤ Master.
2.  Master –≥–æ–≤–æ—Ä–∏—Ç "–û–ö".
3.  Master *–ø–æ—Ç–æ–º* (–≤ —Ñ–æ–Ω–µ) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ Slave.

*–ü–ª—é—Å*: –ë—ã—Å—Ç—Ä–æ (Master –Ω–µ –∂–¥–µ—Ç Slave).
*–ú–∏–Ω—É—Å*: –ï—Å–ª–∏ Master —Å–≥–æ—Ä–∏—Ç –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö, **–¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è**. Slave –±—É–¥–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å.

```mermaid
sequenceDiagram
    participant User as Client
    participant Master
    participant Slave
    
    User->>Master: INSERT (–ó–∞–ø–∏—Å—å)
    Master-->>User: OK (200)
    Note over Master: "–Ø –∑–∞–ø–∏—à—É —ç—Ç–æ –ø–æ–∑–∂–µ"
    Master-)Slave: Replicate Data (Async)
```

### –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (Sync) ‚Äî *–ù–∞–¥–µ–∂–Ω–æ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ*
1.  –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –≤ Master.
2.  Master –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ Slave.
3.  Slave –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç: "–°–æ—Ö—Ä–∞–Ω–∏–ª".
4.  Master –≥–æ–≤–æ—Ä–∏—Ç –ö–ª–∏–µ–Ω—Ç—É: "–û–ö".

```mermaid
sequenceDiagram
    participant User as Client
    participant Master
    participant Slave
    
    User->>Master: INSERT (–ó–∞–ø–∏—Å—å)
    Master->>Slave: Replicate Data
    Slave-->>Master: ACK (–°–æ—Ö—Ä–∞–Ω–∏–ª)
    Master-->>User: OK (200)
```

*–ü–ª—é—Å*: –ì–∞—Ä–∞–Ω—Ç–∏—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –º–∏–Ω–∏–º—É–º –Ω–∞ –¥–≤—É—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö. Zero data loss.
*–ú–∏–Ω—É—Å*: –ú–µ–¥–ª–µ–Ω–Ω–æ (–∂–¥–µ–º —Å–∞–º–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ). –ï—Å–ª–∏ Slave —É–ø–∞–ª ‚Äî Master –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –∑–∞–ø–∏—Å—å (–≤—Å—Ç–∞–µ—Ç –∫–æ–ª–æ–º).

---

## 3. üõ°Ô∏è CAP-—Ç–µ–æ—Ä–µ–º–∞

–¢–µ–æ—Ä–µ–º–∞ –≠—Ä–∏–∫–∞ –ë—Ä—é–µ—Ä–∞ –≥–ª–∞—Å–∏—Ç: –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–∏ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. **–í—ã–±–∏—Ä–∞–π—Ç–µ –ª—é–±—ã–µ –¥–≤–∞**.

*   **C (Consistency)** ‚Äî –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å. –í–æ –≤—Å–µ—Ö —É–∑–ª–∞—Ö –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. (–ï—Å–ª–∏ —è –∑–∞–ø–∏—Å–∞–ª X=5, —Ç–æ –ª—é–±–æ–π, –∫—Ç–æ —á–∏—Ç–∞–µ—Ç, —É–≤–∏–¥–∏—Ç 5 –∏–ª–∏ –æ—à–∏–±–∫—É).
*   **A (Availability)** ‚Äî –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö –∏–ª–∏ –Ω–µ—É–¥–∞—á—É), –Ω–æ –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ. –°–∏—Å—Ç–µ–º–∞ "–∂–∏–≤–∞" –≤—Å–µ–≥–¥–∞.
*   **P (Partition Tolerance)** ‚Äî –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—é. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–≤—è–∑—å –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏ (—Å–µ—Ç—å) –ø–æ—Ä–≤–∞–ª–∞—Å—å.

> [!WARNING]
> –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ **P (Partition Tolerance)** –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (—Å–µ—Ç—å –º–æ–∂–µ—Ç –ª–∞–≥–∞—Ç—å –≤—Å–µ–≥–¥–∞). –ü–æ—ç—Ç–æ–º—É –º—ã –≤—ã–±–∏—Ä–∞–µ–º –º–µ–∂–¥—É **CP** (Consistency) –∏ **AP** (Availability).

---

## 4. ‚öñÔ∏è Trade-off: –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é: **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–µ—Ä–µ—Ä–µ–∑–∞–ª–∏**, Master –∏ Slave –Ω–µ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ (Split-Brain).
–ö–ª–∏–µ–Ω—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫ Slave (–∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∑–Ω–∞–µ—Ç, —á—Ç–æ —Ç–∞–º –Ω–∞ Master'–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç).

**–°–∏—Ç—É–∞—Ü–∏—è: –†–∞–∑—Ä—ã–≤ —Å–µ—Ç–∏ (Partition)**

### –í—ã–±–æ—Ä CP (Consistency over Availability)
"–Ø (Slave) –Ω–µ –≤–∏–∂—É –ú–∞—Å—Ç–µ—Ä–∞ –∏ –Ω–µ –º–æ–≥—É –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –º–æ–∏ –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã. –ü–æ—ç—Ç–æ–º—É —è **–æ—Ç–∫–∞–∂—É—Å—å –æ—Ç–≤–µ—á–∞—Ç—å**."
*   **–û—Ç–≤–µ—Ç**: `HTTP 500 Error` / Timeout.
*   **–ü—Ä–∏–º–µ—Ä**: –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –õ—É—á—à–µ –Ω–µ –ø–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å, —á–µ–º –ø–æ–∫–∞–∑–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–π –∏ –¥–∞—Ç—å —Å–Ω—è—Ç—å –¥–µ–Ω—å–≥–∏ –¥–≤–∞–∂–¥—ã.

### –í—ã–±–æ—Ä AP (Availability over Consistency)
"–Ø (Slave) –Ω–µ –≤–∏–∂—É –ú–∞—Å—Ç–µ—Ä–∞, –≤–æ–∑–º–æ–∂–Ω–æ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏, –Ω–æ **–ª—É—á—à–µ —è –æ—Ç–¥–∞–º —Å—Ç–∞—Ä–æ–µ, —á–µ–º –Ω–∏—á–µ–≥–æ**."
*   **–û—Ç–≤–µ—Ç**: `HTTP 200 OK` (–î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å 5-–º–∏–Ω—É—Ç–Ω–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏).
*   **–ü—Ä–∏–º–µ—Ä**: –õ–µ–Ω—Ç–∞ —Å–æ—Ü—Å–µ—Ç–∏, –ª–∞–π–∫–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏. –ï—Å–ª–∏ –≤—ã –Ω–µ —É–≤–∏–¥–∏—Ç–µ —Å–≤–µ–∂–∏–π –ª–∞–π–∫ 5 —Å–µ–∫—É–Ω–¥ ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ —É–º—Ä–µ—Ç, –∑–∞—Ç–æ —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.
