# üï∑Ô∏è Tarantool

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ß—Ç–æ —ç—Ç–æ? (DB + App Server)](#—á—Ç–æ-—ç—Ç–æ-db--app-server)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (Tuple & Space)](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö-tuple--space)
3. [–î–≤–∏–∂–∫–∏ (Memtx vs Vinyl)](#–¥–≤–∏–∂–∫–∏-memtx-vs-vinyl)
4. [Lua –∏ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞](#lua-–∏-–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)

---

## 1. ü§î –ß—Ç–æ —ç—Ç–æ? (DB + App Server)

**Tarantool** ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ Redis), –∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–∫–∞–∫ Node.js). –≠—Ç–æ **–¥–≤–∞ –≤ –æ–¥–Ω–æ–º**.
–≠—Ç–æ In-Memory NoSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–∫—Ä—É—Ç–∏–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è **Lua**.

> [!NOTE]
> **–ì–ª–∞–≤–Ω–∞—è —Ñ–∏—à–∫–∞**: –í—ã –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (—Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã) –ø—Ä—è–º–æ *–≤–Ω—É—Ç—Ä–∏* –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –î–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤ —Ç–æ–π –∂–µ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏, –≥–¥–µ –∫—Ä—É—Ç–∏—Ç—Å—è –≤–∞—à –∫–æ–¥.
> **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù—É–ª–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –Ω–∞ —Å–µ—Ç—å (Network Overhead = 0).

---

## 2. üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (Tuple & Space)

Tarantool –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã (–∫–∞–∫ SQL) –∏–ª–∏ –∫–ª—é—á–∏-–∑–Ω–∞—á–µ–Ω–∏—è (–∫–∞–∫ Redis). –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Space** –∏ **Tuple**.

### üåå Space (–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ)
–ê–Ω–∞–ª–æ–≥ **–¢–∞–±–ª–∏—Ü—ã** –≤ SQL –∏–ª–∏ –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –≤ MongoDB.

### üç± Tuple (–ö–æ—Ä—Ç–µ–∂)
–ê–Ω–∞–ª–æ–≥ **–°—Ç—Ä–æ–∫–∏**. –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –º–∞—Å—Å–∏–≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã.
*   –ü—Ä–∏–º–µ—Ä: `[1, "Ivan", 25, "active"]`
*   –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç JSON (MongoDB), —Ç—É—Ç –Ω–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–π –ø–æ–ª–µ–π, —Ç–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å—ã (0, 1, 2...). –ù–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å "–§–æ—Ä–º–∞—Ç", —á—Ç–æ–±—ã –æ–±—Ä–∞—â–∞—Ç—å—Å—è –ø–æ –∏–º–µ–Ω–∞–º.

```mermaid
graph TD
    subgraph Space_Users [Space: Users]
        T1["Tuple 1: [1, 'Ali', 'admin']"]
        T2["Tuple 2: [2, 'Bob', 'user']"]
    end
    
    Index[Primary Index: TREE] --> T1
    Index --> T2
```

---

## 3. ‚öôÔ∏è –î–≤–∏–∂–∫–∏ (Memtx vs Vinyl)

–ö–∞–∫ –∏ –≤ MySQL (InnoDB/MyISAM), –≤ Tarantool –µ—Å—Ç—å –¥–≤–∏–∂–∫–∏.

### üöÄ Memtx (In-Memory)
*   –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∂–∏–≤—É—Ç –≤ **RAM** (–æ–ø–µ—Ä–∞—Ç–∏–≤–∫–µ).
*   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å.
*   Snapshots (—Å–Ω–∏–º–∫–∏) –∏ XLOG (–ª–æ–≥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π) –ø–∏—à—É—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

### üíæ Vinyl (On-Disk)
*   –î–∞–Ω–Ω—ã–µ –∂–∏–≤—É—Ç –Ω–∞ **–î–∏—Å–∫–µ** (HDD/SSD).
*   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è LSM-Tree (Log-Structured Merge Tree).
*   –ü–æ–¥—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –±–æ–ª—å—à–µ, —á–µ–º –æ–ø–µ—Ä–∞—Ç–∏–≤–∫–∏.

---

## 4. üåô Lua –∏ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å `SELECT` –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –±–∞–∑—É, –≤—ã –ø–∏—à–µ—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞ Lua –≤–Ω—É—Ç—Ä–∏ Tarantool.

**–ü—Ä–∏–º–µ—Ä (–ø—Å–µ–≤–¥–æ–∫–æ–¥):**
```lua
function transfer_money(from_id, to_id, amount)
    box.begin() -- –°—Ç–∞—Ä—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    
    local sender = box.space.users:get(from_id)
    local receiver = box.space.users:get(to_id)
    
    if sender.balance < amount then
        box.rollback()
        return error("No money")
    end
    
    box.space.users:update(from_id, {{'-', 'balance', amount}})
    box.space.users:update(to_id, {{'+', 'balance', amount}})
    
    box.commit()
end
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç: `call transfer_money(1, 2, 100)`.

---

## üí° –ò—Ç–æ–≥
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Tarantool, –∫–æ–≥–¥–∞ –≤–∞–º –Ω—É–∂–µ–Ω **Highload** –∏ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–±–∏–ª–ª–∏–Ω–≥, —Å–µ—Å—Å–∏–∏, –∏–≥—Ä–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏).