# üê∞ RabbitMQ

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ß—Ç–æ —ç—Ç–æ?](#1-—á—Ç–æ-—ç—Ç–æ)
2. [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?](#2-–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
3. [–ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏](#3-–≥–∞—Ä–∞–Ω—Ç–∏–∏-–¥–æ—Å—Ç–∞–≤–∫–∏)
4. [Dead Letter Exchange (DLX)](#4-dead-letter-exchange-dlx)

---

## 1. ü§î –ß—Ç–æ —ç—Ç–æ?

**RabbitMQ** ‚Äî —ç—Ç–æ "—É–º–Ω—ã–π" –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Kafka (–∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Å—Ç–æ —Ö—Ä–∞–Ω–∏—Ç –ª–æ–≥), RabbitMQ —É–º–µ–µ—Ç —Å–∞–º–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —Å–ª–æ–∂–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º.

*   **–ü—Ä–æ—Ç–æ–∫–æ–ª**: AMQP 0.9.1.
*   **–°—Ç–∏–ª—å**: Smart Broker, Dumb Consumer.

---

## 2. ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

```mermaid
graph LR
    Pub((Publisher)) -->|1. Publish| Ex{Exchange}
    Ex -->|2. Route| Q1[Queue A]
    Ex -->|2. Route| Q2[Queue B]
    Q1 -->|3. Push| Cons1((Consumer))
```

1.  **Publisher**: –ù–µ –∫–ª–∞–¥–µ—Ç –ø–∏—Å—å–º–æ —Å—Ä–∞–∑—É –≤ —è—â–∏–∫. –û–Ω –æ—Ç–¥–∞–µ—Ç –µ–≥–æ –ø–æ—á—Ç–∞–ª—å–æ–Ω—É (**Exchange**).
2.  **Exchange**: –°–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∞–¥—Ä–µ—Å (Routing Key) –∏ —Ä–∞—Å—Å–æ–≤—ã–≤–∞–µ—Ç –ø–∏—Å—å–º–æ –ø–æ –û—á–µ—Ä–µ–¥—è–º (**Queues**).
3.  **Consumer**: –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –æ—á–µ—Ä–µ–¥—å. –ë—Ä–æ–∫–µ—Ä —Å–∞–º –ø—Ä–æ—Ç–∞–ª–∫–∏–≤–∞–µ—Ç –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–µ (**Push**).

---

## 3. üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

RabbitMQ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ –Ω–∞–¥–µ–∂–Ω–æ. –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —Ç—Ä–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞:

### 1. Persistence (–°—Ç–æ–π–∫–æ—Å—Ç—å)
*   **Durable Exchange/Queue**: –°–∞–º–∞ –æ—á–µ—Ä–µ–¥—å –Ω–µ –∏—Å—á–µ–∑–Ω–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ RabbitMQ.
*   **Persistent Messages**: –°–æ–æ–±—â–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ (`deliveryMode=2`). –ò–Ω–∞—á–µ –æ–Ω–∏ –∂–∏–≤—É—Ç —Ç–æ–ª—å–∫–æ –≤ RAM –∏ –ø—Ä–æ–ø–∞–¥—É—Ç –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ.

### 2. Publisher Confirms
–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, –ø—Ä–∏–Ω—è–ª–∞ –ª–∏ RabbitMQ –ø–∏—Å—å–º–æ.
*   –í–∫–ª—é—á–∞–µ–º `confirmSelect`.
*   –ï—Å–ª–∏ –±—Ä–æ–∫–µ—Ä –Ω–µ –ø—Ä–∏—Å–ª–∞–ª `ack` –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–Ω–æ–≤–∞.

### 3. Consumer Acknowledgement (–†—É—á–Ω–æ–π Ack)
–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ.
*   **Auto-Ack (default)**: –ë—Ä–æ–∫–µ—Ä —Å—á–∏—Ç–∞–µ—Ç –ø–∏—Å—å–º–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏–ª –µ–≥–æ –≤ TCP-—Å–æ–∫–µ—Ç. –ï—Å–ª–∏ –∫–æ–Ω—Å—å—é–º–µ—Ä —É–ø–∞–ª –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Äî –ø–∏—Å—å–º–æ –ø–æ—Ç–µ—Ä—è–Ω–æ.
*   **Manual-Ack**: –ö–æ–Ω—Å—å—é–º–µ—Ä –≥–æ–≤–æ—Ä–∏—Ç "–Ø –æ–±—Ä–∞–±–æ—Ç–∞–ª" (`basic.ack`) —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ** —Ç–æ–≥–æ, –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏–ª –¥–∞–Ω–Ω—ã–µ –≤ –ë–î. –ï—Å–ª–∏ –∫–æ–Ω—Å—å—é–º–µ—Ä —É–ø–∞–ª –±–µ–∑ Ack, –±—Ä–æ–∫–µ—Ä –≤–µ—Ä–Ω–µ—Ç –ø–∏—Å—å–º–æ –≤ –æ—á–µ—Ä–µ–¥—å –¥—Ä—É–≥–æ–º—É –∫–æ–Ω—Å—å—é–º–µ—Ä—É.

---

## 4. üíÄ Dead Letter Exchange (DLX)

–ö—É–¥–∞ –¥–µ–≤–∞—Ç—å –ø–∏—Å—å–º–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫—Ç–æ –Ω–µ —Å–º–æ–≥ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å?
–ï—Å–ª–∏ RabbitMQ –ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ 10 —Ä–∞–∑ –∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É (`basic.nack`), –ø–∏—Å—å–º–æ –º–æ–∂–µ—Ç –∑–∞—Ü–∏–∫–ª–∏—Ç—å—Å—è.

**DLX** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ—Å—ã–ª–∫–∏ "–º–µ—Ä—Ç–≤—ã—Ö" –ø–∏—Å–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å.

**–ü—Ä–∏—á–∏–Ω—ã —Å–º–µ—Ä—Ç–∏ –ø–∏—Å—å–º–∞:**
1.  **Rejected**: –ö–æ–Ω—Å—å—é–º–µ—Ä —Å–∫–∞–∑–∞–ª `basic.reject(requeue=false)`.
2.  **Expired**: –ò—Å—Ç–µ–∫ TTL (Time To Live) —Å–æ–æ–±—â–µ–Ω–∏—è.
3.  **MaxLength**: –û—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–∏–ª–∞—Å—å.

```mermaid
graph TD
    P[Publisher] --> Ex{Main Exchange}
    Ex --> Q[Main Queue]
    Q -->|Error/Reject| DLX{DLX Exchange}
    DLX --> DLQ[Dead Letter Queue]
    DLQ --> Admin[Admin / Alert]
```

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–æ—Ç–æ–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å DLQ –∏ –ø–æ–Ω—è—Ç—å, –ø–æ—á–µ–º—É –ø–∏—Å—å–º–∞ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (–±–∞–≥ –≤ –∫–æ–¥–µ, –±–∏—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ).