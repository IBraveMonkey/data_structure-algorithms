# üç∞ 5. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (Partitioning)

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?](#1-—á—Ç–æ-—ç—Ç–æ-—Ç–∞–∫–æ–µ)
2. [–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ vs –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ](#2-–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ-vs-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ)
3. [–¢–∏–ø—ã –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è](#3-—Ç–∏–ø—ã-–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
4. [–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?](#4-–∑–∞—á–µ–º-—ç—Ç–æ-–Ω—É–∂–Ω–æ)

---

## 1. ü§î –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

**–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —ç—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π –±–æ–ª—å—à–æ–π —Ç–∞–±–ª–∏—Ü—ã (Parent Table) –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∫—É—Å–∫–æ–≤ (**–ø–∞—Ä—Ç–∏—Ü–∏–π**).
–ü—Ä–∏ —ç—Ç–æ–º –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—Å—ë –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞. –°–£–ë–î —Å–∞–º–∞ –ø–æ–Ω–∏–º–∞–µ—Ç, –≤ –∫–∞–∫–æ–π –∫—É—Å–æ–∫ –ø–æ–ª–æ–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –æ—Ç–∫—É–¥–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å.

> [!NOTE]
> –í—Å–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è **–Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ** (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è).

```mermaid
graph TD
    App[–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ] --> Parent[–¢–∞–±–ª–∏—Ü–∞: Orders]
    Parent -.-> P1[Partition 1: –Ø–Ω–≤–∞—Ä—å]
    Parent -.-> P2[Partition 2: –§–µ–≤—Ä–∞–ª—å]
    Parent -.-> P3[Partition 3: –ú–∞—Ä—Ç]
```

---

## 2. ‚öîÔ∏è –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ vs –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ú–Ω–æ–≥–∏–µ –ø—É—Ç–∞—é—Ç —ç—Ç–∏ –ø–æ–Ω—è—Ç–∏—è.

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **–ì–¥–µ –∂–∏–≤—É—Ç –¥–∞–Ω–Ω—ã–µ?** | –ù–∞ **–æ–¥–Ω–æ–º** —Å–µ—Ä–≤–µ—Ä–µ (–≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö). | –ù–∞ **—Ä–∞–∑–Ω—ã—Ö** —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö. |
| **–¶–µ–ª—å** | –£—Å–∫–æ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å *–æ–¥–Ω–æ–π* –º–∞—à–∏–Ω–æ–π, —É–¥–æ–±—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è. | –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ–≥–¥–∞ –æ–¥–Ω–∞ –º–∞—à–∏–Ω–∞ *–Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è*. |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | –ù–∏–∑–∫–∞—è (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –°–£–ë–î –∏–∑ –∫–æ—Ä–æ–±–∫–∏). | –í—ã—Å–æ–∫–∞—è (–Ω—É–∂–µ–Ω —Ä–æ—É—Ç–µ—Ä, —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞). |

---

## 3. üóÇÔ∏è –¢–∏–ø—ã –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

–í PostgreSQL (–∏ –¥—Ä—É–≥–∏—Ö RDBMS) –µ—Å—Ç—å —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

### 1. By Range (–ü–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É)
–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç–∏–ø. –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–∞—Ç.
*   "–í—Å–µ –∑–∞–∫–∞–∑—ã –∑–∞ –Ø–Ω–≤–∞—Ä—å ‚Äî –≤ –æ–¥–Ω—É –∫—É—á—É, –∑–∞ –§–µ–≤—Ä–∞–ª—å ‚Äî –≤ –¥—Ä—É–≥—É—é".

```sql
CREATE TABLE orders (id int, date date) PARTITION BY RANGE (date);
CREATE TABLE orders_jan PARTITION OF orders FOR VALUES FROM ('2023-01-01') TO ('2023-02-01');
```

### 2. By List (–ü–æ —Å–ø–∏—Å–∫—É)
–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º.
*   "–ö–ª–∏–µ–Ω—Ç—ã –∏–∑ –ú–æ—Å–∫–≤—ã –∏ –ü–∏—Ç–µ—Ä–∞ ‚Äî —Ç—É—Ç, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî —Ç–∞–º".
*   `PARTITION BY LIST (region)`: ('Moscow', 'SPb')

### 3. By Hash (–ü–æ —Ö–µ—à—É)
–î–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ.
*   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–µ—Ç —á–µ—Ç–∫–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è (–¥–∞—Ç—ã –∏–ª–∏ —Ä–µ–≥–∏–æ–Ω–∞), –Ω–æ –Ω—É–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –æ–≥—Ä–æ–º–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –Ω–∞ 4 —á–∞—Å—Ç–∏, —á—Ç–æ–±—ã –æ–Ω–∏ –≤–ª–µ–∑–ª–∏ –≤ –ø–∞–º—è—Ç—å.
*   `PARTITION BY HASH (id)`

---

## 4. üöÄ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

1.  **–°–∫–æ—Ä–æ—Å—Ç—å (Partition Pruning)**:
    *   –ï—Å–ª–∏ –≤—ã –¥–µ–ª–∞–µ—Ç–µ –∑–∞–ø—Ä–æ—Å `SELECT * FROM orders WHERE date = '2023-01-15'`, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö **–ø–æ–π–º–µ—Ç**, —á—Ç–æ –∏—Å–∫–∞—Ç—å –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –ø–∞—Ç–∏—Ü–∏–∏ "–Ø–Ω–≤–∞—Ä—å". –û–Ω–∞ –¥–∞–∂–µ –Ω–µ –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –§–µ–≤—Ä–∞–ª—è –∏ –ú–∞—Ä—Ç–∞.
    *   –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏—Ö –æ–±—ä–µ–º–∞—Ö.
2.  **–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Data Retention)**:
    *   –ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø—Ä–æ—à–ª—ã–π –≥–æ–¥ –∏–∑ –æ–±—ã—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å `DELETE`. –≠—Ç–æ —Ç—è–∂–µ–ª–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, —Ä–∞—Å—Ç–µ—Ç VACUUM).
    *   –° –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤—ã –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–µ—Ç–µ `DROP TABLE orders_2022`. –≠—Ç–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞.
3.  **–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ**:
    *   –ú–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å `REINDEX` —Ç–æ–ª—å–∫–æ "–≥–æ—Ä—è—á–µ–π" –ø–∞—Ä—Ç–∏—Ü–∏–∏ (—Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö), –Ω–µ —Ç—Ä–æ–≥–∞—è –∞—Ä—Ö–∏–≤.

> [!TIP]
> –ù–∞—á–∏–Ω–∞–π—Ç–µ –¥—É–º–∞—Ç—å –æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏, –∫–æ–≥–¥–∞ —Ç–∞–±–ª–∏—Ü–∞ –≤—ã—Ä–∞—Å—Ç–∞–µ—Ç –¥–æ **–¥–µ—Å—è—Ç–∫–æ–≤ –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Å—Ç—Ä–æ–∫** –∏–ª–∏ **100+ –ì–ë**. –î–æ —ç—Ç–æ–≥–æ –∏–Ω–¥–µ–∫—Å—ã —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–ª–∏—á–Ω–æ.
