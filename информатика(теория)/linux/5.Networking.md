# üåê Networking & Sockets (–°–µ—Ç–∏ –∏ —Å–æ–∫–µ—Ç—ã)

–í Linux —Å–µ—Ç–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º —Å–æ–∫–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ –≤–ø–∏—Å–∞–Ω –≤ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é ¬´–≤—Å—ë –µ—Å—Ç—å —Ñ–∞–π–ª¬ª.

---

## 1. üîå –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–æ–∫–µ—Ç (Socket)?

**–°–æ–∫–µ—Ç** ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏. –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫ –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ (Unix Domain Sockets), —Ç–∞–∫ –∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö (TCP/IP).

### üè∑ –°–æ–∫–µ—Ç –∫–∞–∫ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä
–ö–æ–≥–¥–∞ –≤—ã —Å–æ–∑–¥–∞–µ—Ç–µ —Å–µ—Ç–µ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —è–¥—Ä–æ –≤—ã–¥–µ–ª—è–µ—Ç –≤–∞–º **Socket Descriptor**. –≠—Ç–æ —Ç–∞–∫–æ–π –∂–µ –§–∞–π–ª–æ–≤—ã–π –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä (FD), –∫–∞–∫ –∏ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞, –Ω–æ —Å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏:
- –ö —Ñ–∞–π–ª—É –Ω–∞ –¥–∏—Å–∫–µ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å `lseek` (–ø–µ—Ä–µ–º–æ—Ç–∞—Ç—å), –∫ —Å–æ–∫–µ—Ç—É ‚Äî –Ω–µ—Ç. –≠—Ç–æ –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö.
- –°–æ–∫–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –Ω–µ –∫ –±–ª–æ–∫–∞–º –Ω–∞ –¥–∏—Å–∫–µ, –∞ –∫ —Å–µ—Ç–µ–≤–æ–º—É —Å—Ç–µ–∫—É —è–¥—Ä–∞.

> [!TIP]
> –¢–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ —Å–æ–∫–µ—Ç ‚Äî —ç—Ç–æ FD, –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –Ω–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã `read()` –∏ `write()`. –ü—Ä–æ–≥—Ä–∞–º–º–µ ¬´–ø–æ—á—Ç–∏¬ª –≤—Å—ë —Ä–∞–≤–Ω–æ, –ø–∏—à–µ—Ç –æ–Ω–∞ –≤ —Ñ–∞–π–ª –∏–ª–∏ –≤ —Å–µ—Ç–µ–≤–æ–π –∫–∞–Ω–∞–ª.

---

## üèó –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ê–Ω–∞–ª–æ–≥–∏—è —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º)

–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–∫–µ—Ç–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ –∞–ø–ø–∞—Ä–∞—Ç–∞ –≤ –æ—Ñ–∏—Å–µ:
1.  **socket()**: –í–∞–º –≤—ã–¥–∞–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø—Ä–∏—Å–≤–æ–∏–ª–∏ –µ–º—É –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä (FD).
2.  **bind()**: –í—ã –∑–∞–∫—Ä–µ–ø–∏–ª–∏ –∑–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –≥–æ—Ä–æ–¥—Å–∫–æ–π –Ω–æ–º–µ—Ä (IP –∏ –ü–æ—Ä—Ç), —á—Ç–æ–±—ã –≤–∞–º –º–æ–≥–ª–∏ –¥–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è.
3.  **listen()**: –í—ã –≤–∫–ª—é—á–∏–ª–∏ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è –∑–≤–æ–Ω–∫–∞.
4.  **accept()**: –í—ã —Å–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É, –∫–æ–≥–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –∑–∞–∑–≤–æ–Ω–∏–ª.
5.  **connect()**: –í—ã —Å–∞–º–∏ –Ω–∞–±–∏—Ä–∞–µ—Ç–µ —á–µ–π-—Ç–æ –Ω–æ–º–µ—Ä.

---

## 2. üß± iptables & Netfilter

–≠—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–µ–≤—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ —è–¥—Ä–∞.

- **Netfilter**: –ú–æ–¥—É–ª—å –≤–Ω—É—Ç—Ä–∏ —è–¥—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç—ã.
- **iptables**: –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª (—Ä–∞–∑—Ä–µ—à–∏—Ç—å/–∑–∞–ø—Ä–µ—Ç–∏—Ç—å/–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å).

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã iptables:
| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|:---|:---|
| **Filter** | –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (ACCEPT/DROP). |
| **NAT** | –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è IP-–∞–¥—Ä–µ—Å–æ–≤ (Forwarding). |
| **Mangle** | –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø–∞–∫–µ—Ç–æ–≤. |

---

## üõ† –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `ss -tulpn` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–æ–∫–µ—Ç—ã, –ø–æ—Ä—Ç—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã (–∑–∞–º–µ–Ω–∞ —Å—Ç–∞—Ä–æ–º—É `netstat`).
- `ip addr` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.
- `tcpdump` ‚Äî –∑–∞—Ö–≤–∞—Ç –∏ –∞–Ω–∞–ª–∏–∑ —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
