# ‚ö° NATS

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ß—Ç–æ —ç—Ç–æ? (–°–∫–æ—Ä–æ—Å—Ç—å –∏ –ü—Ä–æ—Å—Ç–æ—Ç–∞)](#1-—á—Ç–æ-—ç—Ç–æ-—Å–∫–æ—Ä–æ—Å—Ç—å-–∏-–ø—Ä–æ—Å—Ç–æ—Ç–∞)
2. [NATS Core (Fire and Forget)](#2-nats-core-fire-and-forget)
3. [NATS JetStream (–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å)](#3-nats-jetstream-–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å)

---

## 1. üèéÔ∏è –ß—Ç–æ —ç—Ç–æ? (–°–∫–æ—Ä–æ—Å—Ç—å –∏ –ü—Ä–æ—Å—Ç–æ—Ç–∞)

**NATS** ‚Äî —ç—Ç–æ –±—Ä–æ–∫–µ—Ä –Ω–∞ —Å—Ç–µ—Ä–æ–∏–¥–∞—Ö, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Go.
–û–Ω –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏:
1.  **Core NATS**: –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π Pub/Sub (–∫–∞–∫ —Ä–∞–¥–∏–æ).
2.  **JetStream**: –°–ª–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤–µ—Ä—Ö Core (–∫–∞–∫ Kafka).

---

## 2. üî• NATS Core (Fire and Forget)

*   **–ì–∞—Ä–∞–Ω—Ç–∏—è**: At-Most-Once (–ú–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑).
*   **–ü–æ–≤–µ–¥–µ–Ω–∏–µ**: –ï—Å–ª–∏ –≤—ã –Ω–µ —Å–ª—É—à–∞–ª–∏ —Ä–∞–¥–∏–æ –≤ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—á–∏, –≤—ã –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –ø–µ—Å–Ω—é. –ë—Ä–æ–∫–µ—Ä –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é.
*   **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: Service Discovery, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, –º–µ—Ç—Ä–∏–∫–∏.

---

## 3. ‚úàÔ∏è NATS JetStream (–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å)

JetStream –¥–æ–±–∞–≤–ª—è–µ—Ç **Persistence** (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫).

### üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
JetStream –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–∏ —É—Ä–æ–≤–Ω—è, –≤–∫–ª—é—á–∞—è **Exactly-Once**.

#### 1. At-Least-Once (–ö–∞–∫ –º–∏–Ω–∏–º—É–º —Ä–∞–∑)
–ö–æ–Ω—Å—å—é–º–µ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `Ack`. –ï—Å–ª–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞ 30 —Å–µ–∫—É–Ω–¥ ‚Äî NATS –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–æ–≤–∞.

#### 2. Exactly-Once (–†–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑)
–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Kafka (–≥–¥–µ —ç—Ç–æ —Å–ª–æ–∂–Ω–æ), –≤ NATS —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏" –±–ª–∞–≥–æ–¥–∞—Ä—è **Deduplication Window**.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**
1.  –ü—É–±–ª–∏—à–µ—Ä —à–ª–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `Nats-Msg-Id: uuid-123`.
2.  JetStream –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —ç—Ç–æ—Ç ID –Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä) 2 –º–∏–Ω—É—Ç—ã.
3.  –ï—Å–ª–∏ –ü—É–±–ª–∏—à–µ—Ä (–∏–∑-–∑–∞ —Å–±–æ—è —Å–µ—Ç–∏) –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–Ω–æ–≤–∞ ‚Äî JetStream —É–≤–∏–¥–∏—Ç –¥—É–±–ª—å ID –∏ —Å–∫–∞–∂–µ—Ç "–û–∫", –Ω–æ **–Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç** –¥—É–±–ª—å –∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç –µ–≥–æ –∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º.

```mermaid
graph LR
    Pub[Publisher] -->|Msg-ID: A (1st)| JS{JetStream}
    Pub -->|Msg-ID: A (Retry)| JS
    
    JS -->|Save & Send| Cons[Consumer]
    JS -.->|Drop Duplicate| Trash[üóëÔ∏è]
```

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç NATS JetStream –æ—á–µ–Ω—å –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –≥–¥–µ –¥—É–±–ª–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã.