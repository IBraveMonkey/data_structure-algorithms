# üçÉ 1. MongoDB: –î–æ–∫—É–º–µ–Ω—Ç–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏](#1-–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (BSON)](#2-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö-bson)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Replica Set](#3-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-replica-set)
4. [–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: Sharding](#4-–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ-sharding)
5. [SQL vs MongoDB (Cheat Sheet)](#5-sql-vs-mongodb)

---

## 1. üß± –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

–ï—Å–ª–∏ –≤—ã –ø—Ä–∏—à–ª–∏ –∏–∑ –º–∏—Ä–∞ SQL, —Ç–æ –≤–æ—Ç —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –ø–æ–Ω—è—Ç–∏–π:

| SQL (RDBMS) | MongoDB | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **Database** | **Database** | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–≥—Ä—É–ø–ø–∞ —Ç–∞–±–ª–∏—Ü/–∫–æ–ª–ª–µ–∫—Ü–∏–π). |
| **Table** | **Collection** | –ö–æ–ª–ª–µ–∫—Ü–∏—è. –ì—Ä—É–ø–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –°—Ö–µ–º–∞ –Ω–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞! |
| **Row** | **Document** | –î–æ–∫—É–º–µ–Ω—Ç. JSON-–ø–æ–¥–æ–±–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏. |
| **Column** | **Field** | –ü–æ–ª–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ. |
| **Index** | **Index** | –ò–Ω–¥–µ–∫—Å (B-Tree). –†–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ. |
| **JOIN** | **$lookup** | –ê–Ω–∞–ª–æ–≥ JOIN (–Ω–æ –¥–æ—Ä–æ–≥–æ–π –∏ —Ä–µ–¥–∫–∏–π). –õ—É—á—à–µ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã. |

### –ò–µ—Ä–∞—Ä—Ö–∏—è
```mermaid
graph TD
    DB[(Database: Shop)]
    Col1(Collection: Users)
    Col2(Collection: Orders)
    
    DB --> Col1
    DB --> Col2
    
    Col1 --> D1["Doc: {id:1, name:'Ali'}"]
    Col1 --> D2["Doc: {id:2, name:'Bob'}"]
```

---

## 2. üìÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (BSON)

MongoDB —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤ —á–∏—Å—Ç–æ–º JSON, –∞ –≤ **BSON** (Binary JSON).
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Ç–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ JSON: `Date`, `ObjectId`, `NumberLong` (int64), –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–ü—Ä–∏–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
```json
{
  "_id": ObjectId("507f1f77bcf86cd799439011"), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π PK (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ)
  "username": "coder123",
  "active": true,
  "balance": 100.50,
  "roles": ["admin", "editor"], // –ú–∞—Å—Å–∏–≤—ã ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞!
  "profile": {                  // –í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (Embedded)
    "age": 25,
    "city": "Moscow"
  },
  "created_at": ISODate("2023-10-01T10:00:00Z")
}
```

> [!TIP]
> **Data Modeling**:
> –í SQL –º—ã –±—ã —Å–æ–∑–¥–∞–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `Roles` –∏ `Profiles`.
> –í MongoDB –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ "–∂–∏–≤—É—Ç –≤–º–µ—Å—Ç–µ", —Ö—Ä–∞–Ω–∏–º –≤–º–µ—Å—Ç–µ (–≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ). –≠—Ç–æ —É–±–∏—Ä–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ JOIN-–∞—Ö –∏ –¥–µ–ª–∞–µ—Ç —á—Ç–µ–Ω–∏–µ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–º (–æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º –∑–∞–±–∏—Ä–∞–µ–º –≤–µ—Å—å –ø—Ä–æ—Ñ–∏–ª—å).

---

## 3. üõ°Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Replica Set

–î–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ (High Availability) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Replica Set**.
–≠—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä –º–∏–Ω–∏–º—É–º –∏–∑ 3-—Ö —É–∑–ª–æ–≤.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?
1.  **Primary**: –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —É–∑–µ–ª, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **–ó–∞–ø–∏—Å—å** (Write) –∏ –ß—Ç–µ–Ω–∏–µ.
2.  **Secondary**: –†–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å Primary. –ú–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ß—Ç–µ–Ω–∏–µ (Optionally).
3.  **–í—ã–±–æ—Ä—ã (Election)**: –ï—Å–ª–∏ Primary –ø–∞–¥–∞–µ—Ç, Secondaries –≥–æ–ª–æ—Å—É—é—Ç –∏ –≤—ã–±–∏—Ä–∞—é—Ç –Ω–æ–≤–æ–≥–æ Primary.

```mermaid
sequenceDiagram
    participant App
    participant P as Primary
    participant S1 as Secondary 1
    participant S2 as Secondary 2

    App->>P: Insert {x:1}
    P->>P: –ó–∞–ø–∏—Å—å –≤ Oplog
    par Replication
        P->>S1: Oplog entry
        P->>S2: Oplog entry
    end
    S1-->>P: ACK
    S2-->>P: ACK
    P-->>App: OK (WriteConcern confirmed)
```

**–ï—Å–ª–∏ Primary —É–º–∏—Ä–∞–µ—Ç:**
1.  S1 –∏ S2 –∑–∞–º–µ—á–∞—é—Ç, —á—Ç–æ P –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (Heartbeat lost).
2.  –û–Ω–∏ –ø—Ä–æ–≤–æ–¥—è—Ç –≤—ã–±–æ—Ä—ã.
3.  S1 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º Primary.
4.  App –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –Ω–æ–≤–æ–º—É Primary –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## 4. üåê –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ: Sharding

–ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ (—Ç–µ—Ä–∞–±–∞–π—Ç—ã), Replica Set –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (–¥–∏—Å–∫ –Ω–µ —Ä–µ–∑–∏–Ω–æ–≤—ã–π). –í–∫–ª—é—á–∞–µ—Ç—Å—è **–®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ**.

–ú—ã "—Ä–∞–∑–º–∞–∑—ã–≤–∞–µ–º" (Partition) –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø–æ —Ä–∞–∑–Ω—ã–º Replica Set-–∞–º (–®–∞—Ä–¥–∞–º).

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∞
1.  **mongos (Router)**: –õ–µ–≥–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±—â–∞–µ—Ç—Å—è *—Ç–æ–ª—å–∫–æ* —Å –Ω–∏–º. –û–Ω –∑–Ω–∞–µ—Ç, –≥–¥–µ –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç, –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω—É–∂–Ω–æ–º—É —à–∞—Ä–¥—É.
2.  **Config Servers**: –•—Ä–∞–Ω—è—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∫–∞—Ä—Ç–∞: "–¥–∏–∞–ø–∞–∑–æ–Ω –∫–ª—é—á–µ–π A-K –ª–µ–∂–∏—Ç –Ω–∞ Shard 1").
3.  **Shards**: –°–∞–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Ü–µ–ª—ã–µ Replica Sets).

```mermaid
flowchart TD
    Client[–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ]
    
    subgraph Routing Layer
        R1[Mongos 1]
        R2[Mongos 2]
    end
    
    subgraph Config Layer
        CS[(Config Servers)]
    end
    
    subgraph Data Layer
        Shard1[(Shard 1: Users A-M)]
        Shard2[(Shard 2: Users N-Z)]
    end
    
    Client --> R1
    Client --> R2
    R1 -.-> CS
    R2 -.-> CS
    R1 --> Shard1
    R1 --> Shard2
```

> [!IMPORTANT]
> **Shard Key**: –°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±—Ä–∞—Ç—å –∫–ª—é—á —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è.
> - –ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—É–¥–∞—á–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª–µ `monotonic_date` –¥–ª—è –ª–æ–≥–æ–≤), —Ç–æ –≤—Å–µ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç –ª–µ—Ç–µ—Ç—å –≤ **–æ–¥–∏–Ω** –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞—Ä–¥ (Hotspot), –∏ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏—è –Ω–µ –±—É–¥–µ—Ç.

---

## 5. üÜö SQL vs MongoDB

–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º.

| –ó–∞–¥–∞—á–∞ | SQL | MongoDB |
| :--- | :--- | :--- |
| **–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å** | `INSERT INTO users (name, age) VALUES ('Ali', 20)` | `db.users.insertOne({name: 'Ali', age: 20})` |
| **–ù–∞–π—Ç–∏ –≤—Å–µ—Ö** | `SELECT * FROM users` | `db.users.find()` |
| **–ü–æ —É—Å–ª–æ–≤–∏—é** | `SELECT * FROM users WHERE age > 18` | `db.users.find({age: {$gt: 18}})` |
| **–û–±–Ω–æ–≤–∏—Ç—å** | `UPDATE users SET age = 21 WHERE name = 'Ali'` | `db.users.updateOne({name: 'Ali'}, {$set: {age: 21}})` |
| **–£–¥–∞–ª–∏—Ç—å** | `DELETE FROM users WHERE age < 10` | `db.users.deleteMany({age: {$lt: 10}})` |
