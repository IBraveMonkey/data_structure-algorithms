# üìä ClickHouse

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ß—Ç–æ —ç—Ç–æ? (OLAP vs OLTP)](#—á—Ç–æ-—ç—Ç–æ-olap-vs-oltp)
2. [–°—Ç—Ä–æ–∫–∏ vs –ö–æ–ª–æ–Ω–∫–∏](#—Å—Ç—Ä–æ–∫–∏-vs-–∫–æ–ª–æ–Ω–∫–∏)
3. [MergeTree (–°–µ—Ä–¥—Ü–µ –ö–ª–∏–∫—Ö–∞—É—Å–∞)](#mergetree-—Å–µ—Ä–¥—Ü–µ-–∫–ª–∏–∫—Ö–∞—É—Å–∞)

---

## 1. ü§î –ß—Ç–æ —ç—Ç–æ? (OLAP vs OLTP)

**ClickHouse** ‚Äî —ç—Ç–æ –∫–æ–ª–æ–Ω–æ—á–Ω–∞—è –°–£–ë–î –¥–ª—è **OLAP** (Online Analytical Processing).

### OLTP (Postgres, MySQL)
*   **–ó–∞–¥–∞—á–∞**: –ë—ã—Å—Ç—Ä–æ –≤—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑, –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å. –†–∞–±–æ—Ç–∞ —Å **–æ–¥–Ω–æ–π** —Å—Ç—Ä–æ–∫–æ–π.
*   **–ó–∞–ø—Ä–æ—Å**: `SELECT * FROM users WHERE id = 1`

### OLAP (ClickHouse)
*   **–ó–∞–¥–∞—á–∞**: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞. "–°–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ –º—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ –∑–∞ –≥–æ–¥ –ø–æ –≤—Å–µ–º —Ä–µ–≥–∏–æ–Ω–∞–º?". –†–∞–±–æ—Ç–∞ —Å **–º–∏–ª–ª–∏–∞—Ä–¥–∞–º–∏** —Å—Ç—Ä–æ–∫, –Ω–æ —Ç–æ–ª—å–∫–æ —Å –ø–∞—Ä–æ–π –∫–æ–ª–æ–Ω–æ–∫.
*   **–ó–∞–ø—Ä–æ—Å**: `SELECT sum(price) FROM orders WHERE date > '2023-01-01'`

> [!NOTE]
> ClickHouse –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –±—ã—Å—Ç—Ä. –ó–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –≤ Postgres –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 10 –º–∏–Ω—É—Ç, –≤ ClickHouse –ø—Ä–æ–ª–µ—Ç–∏—Ç –∑–∞ 0.1 —Å–µ–∫—É–Ω–¥—É.

---

## 2. üèõÔ∏è –°—Ç—Ä–æ–∫–∏ vs –ö–æ–ª–æ–Ω–∫–∏

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É: `| Date | ID | Price |`

### –°—Ç—Ä–æ—á–Ω–∞—è –°–£–ë–î (MySQL)
–•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ:
`[2023-01-01, 1, 100], [2023-01-01, 2, 200], ...`
–ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É `Price`, –¥–∏—Å–∫—É –ø—Ä–∏–¥–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å **–í–°–Æ** —Å—Ç—Ä–æ–∫—É (–≤–º–µ—Å—Ç–µ —Å –Ω–µ–Ω—É–∂–Ω—ã–º–∏ Date –∏ ID).

### –ö–æ–ª–æ–Ω–æ—á–Ω–∞—è –°–£–ë–î (ClickHouse)
–•—Ä–∞–Ω–∏—Ç –∫–∞–∂–¥—É—é –∫–æ–ª–æ–Ω–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ:
*   –§–∞–π–ª Date: `[2023-01-01, 2023-01-01, ...]`
*   –§–∞–π–ª ID: `[1, 2, ...]`
*   –§–∞–π–ª Price: `[100, 200, ...]`

–ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É `Price`, ClickHouse —á–∏—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª Price**.
*   **–≠–∫–æ–Ω–æ–º–∏—è I/O**: –ß–∏—Ç–∞–µ–º –≤ 100 —Ä–∞–∑ –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö.
*   **–°–∂–∞—Ç–∏–µ**: –ö–æ–ª–æ–Ω–∫—É —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (—á–∏—Å–ª–∞) —Å–∂–∏–º–∞—Ç—å –≥–æ—Ä–∞–∑–¥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ.

```mermaid
graph TD
    subgraph Row_Header ["–°—Ç—Ä–æ—á–Ω–∞—è (Row-Oriented)"]
        R1[–î–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫ –ø–µ—Ä–µ–º–µ—à–∞–Ω—ã]
    end
    
    subgraph Col_Header ["–ö–æ–ª–æ–Ω–æ—á–Ω–∞—è (Column-Oriented)"]
        C1[–§–∞–π–ª: –¶–µ–Ω—ã]
        C2[–§–∞–π–ª: –î–∞—Ç—ã]
        C3[–§–∞–π–ª: ID]
    end
    
    Query[–ó–∞–ø—Ä–æ—Å: SUM Price] --> R1
    Query --> C1
    
    style C1 fill:#bbf,stroke:#333,stroke-width:2px
    style R1 fill:#ffc,stroke:#333
```

---

## 3. üå≤ MergeTree (–°–µ—Ä–¥—Ü–µ –ö–ª–∏–∫—Ö–∞—É—Å–∞)

–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Ç–∞–±–ª–∏—Ü ‚Äî **MergeTree**.
–û–Ω –ø–æ—Ö–æ–∂ –Ω–∞ LSM-Tree (Log-Structured Merge Tree).

1.  **–í—Å—Ç–∞–≤–∫–∞**: –î–∞–Ω–Ω—ã–µ –ø–∏—à—É—Ç—Å—è –ø–∞—á–∫–∞–º–∏ (Parts). –ö–∞–∂–¥–∞—è –ø–∞—á–∫–∞ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É.
2.  **–§–æ–Ω**: ClickHouse –≤ —Ñ–æ–Ω–µ –±–µ—Ä–µ—Ç —ç—Ç–∏ –ø–∞—á–∫–∏ –∏ "—Å–ª–∏–≤–∞–µ—Ç" (Merge) –∏—Ö –≤ –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã–µ –∫—É—Å–∫–∏, –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ä—Ç–∏—Ä—É—è.

> [!WARNING]
> –ö–ª–∏–∫—Ö–∞—É—Å **–ø–ª–æ—Ö–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç** —á–∞—Å—Ç—ã–µ –≤—Å—Ç–∞–≤–∫–∏ –ø–æ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–µ (`INSERT INTO ... VALUES (1)`).
> –ü–∏—à–∏—Ç–µ –±–∞—Ç—á–∞–º–∏ (–ø–∞—á–∫–∞–º–∏) –ø–æ 1000-10,000 —Å—Ç—Ä–æ–∫! –ò–Ω–∞—á–µ —Å–µ—Ä–≤–µ—Ä –∑–∞—Ö–ª–µ–±–Ω–µ—Ç—Å—è –≤ —Å–ª–∏—è–Ω–∏—è—Ö (Merges).

---

## üí° –ò—Ç–æ–≥
–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏, –¥–∞—à–±–æ—Ä–¥—ã, —Å—á–∏—Ç–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ —Ç–µ—Ä–∞–±–∞–π—Ç–∞—Ö –ª–æ–≥–æ–≤ ‚Äî **ClickHouse** –≤–∞—à –ª—É—á—à–∏–π –¥—Ä—É–≥. –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ –æ–±—ã—á–Ω—É—é –±–∞–∑—É –¥–ª—è –±—ç–∫–µ–Ω–¥–∞.