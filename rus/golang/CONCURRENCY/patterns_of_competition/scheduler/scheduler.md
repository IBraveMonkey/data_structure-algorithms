### ‚è∞ –ü–∞—Ç—Ç–µ—Ä–Ω Scheduler (–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)

**Scheduler** ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∑–∞–¥–∞—á –≤ –±—É–¥—É—â–µ–º. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—Ä–µ–º–µ–Ω–∏, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏, –µ—Å–ª–∏ –æ–Ω–∞ –±–æ–ª—å—à–µ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω–∞.

---

### üß† –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–≠—Ç–æ –∫–∞–∫ –±—É–¥–∏–ª—å–Ω–∏–∫ –≤ –≤–∞—à–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ. –í—ã —Å—Ç–∞–≤–∏—Ç–µ –µ–≥–æ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (–∑–∞–¥–µ—Ä–∂–∫–∞). –ö–æ–≥–¥–∞ –≤—Ä–µ–º—è –ø—Ä–∏—Ö–æ–¥–∏—Ç, –±—É–¥–∏–ª—å–Ω–∏–∫ –∑–≤–æ–Ω–∏—Ç (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è). –ï—Å–ª–∏ –≤—ã –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å —Ä–∞–Ω—å—à–µ, –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–∫–ª—é—á–∏—Ç—å –±—É–¥–∏–ª—å–Ω–∏–∫ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω —Å—Ä–∞–±–æ—Ç–∞–µ—Ç (–æ—Ç–º–µ–Ω–∞ —Ç–∞–π–º–µ—Ä–∞).

```mermaid
graph LR
    User[User/System] -->|Schedule| S{Scheduler}
    S -->|T+delay| Task[Action Execution]
    User -->|Cancel| S
    S -.->|Aborted| Task
```

---

### üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–í Go –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —á–∞—Å—Ç–æ —Å—Ç—Ä–æ–∏—Ç—Å—è –≤–æ–∫—Ä—É–≥ `time.Timer` –∏–ª–∏ `time.AfterFunc`, –æ–±–µ—Ä–Ω—É—Ç—ã—Ö –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –º—å—é—Ç–µ–∫—Å–æ–º –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

```go
package main

import (
	"fmt"
	"sync"
	"time"
)

// Scheduler —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
// Scheduler manages deferred execution
type Scheduler struct {
	sync.Mutex
	timers map[string]*time.Timer
}

func NewScheduler() *Scheduler {
	return &Scheduler{
		timers: make(map[string]*time.Timer),
	}
}

// Schedule –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
// Schedule schedules function execution
func (s *Scheduler) Schedule(id string, delay time.Duration, action func()) {
	s.Lock()
	defer s.Unlock()

	// –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Å —Ç–∞–∫–∏–º ID —É–∂–µ –µ—Å—Ç—å, –æ—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä—É—é
	// If a task with this ID already exists, cancel the old one
	if t, ok := s.timers[id]; ok {
		t.Stop()
	}

	// –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
	// Creating a new timer
	s.timers[id] = time.AfterFunc(delay, func() {
		action()
		s.Lock()
		delete(s.timers, id)
		s.Unlock()
	})
}

// Cancel –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–¥–∞—á—É
// Cancel abors a task
func (s *Scheduler) Cancel(id string) {
	s.Lock()
	defer s.Unlock()
	if t, ok := s.timers[id]; ok {
		t.Stop()
		delete(s.timers, id)
		fmt.Printf("–ó–∞–¥–∞—á–∞ %s –æ—Ç–º–µ–Ω–µ–Ω–∞\n", id)
	}
}

func main() {
	s := NewScheduler()

	fmt.Println("–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á...")
	// Scheduling tasks...

	s.Schedule("clean-cache", 2*time.Second, func() {
		fmt.Println("--- –ö—ç—à —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω! ---")
	})

	s.Schedule("send-email", 1*time.Second, func() {
		fmt.Println("--- –ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! ---")
	})

	// –û—Ç–º–µ–Ω—è–µ–º –æ–¥–Ω—É –∏–∑ –∑–∞–¥–∞—á
	// Canceling one of the tasks
	time.Sleep(500 * time.Millisecond)
	s.Cancel("clean-cache")

	time.Sleep(2 * time.Second)
	fmt.Println("–†–∞–±–æ—Ç–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
}
```

---

### üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–ì–∏–±–∫–æ—Å—Ç—å**: –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.
2. **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sync.Mutex` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä—É—Ç–∏–Ω.
3. **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è**: `time.AfterFunc` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

> [!WARNING]
> –ï—Å–ª–∏ –≤—ã —Å–æ–∑–¥–∞–µ—Ç–µ —Ç—ã—Å—è—á–∏ —Ç–∞–π–º–µ—Ä–æ–≤, –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –∏—Ö –æ—á–∏—â–∞—Ç—å –∏–ª–∏ –æ—Ç–º–µ–Ω—è—Ç—å, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏.
