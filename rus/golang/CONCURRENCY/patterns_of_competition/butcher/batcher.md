### üì¶ –ü–∞—Ç—Ç–µ—Ä–Ω Batcher (–ë–∞—Ç—á–µ—Ä)

**Batcher** ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–ª–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ–¥–Ω—É –≥—Ä—É–ø–ø—É (–±–∞—Ç—á) –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –æ—á–µ—Ä–µ–¥—è–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ —Å–µ—Ç–µ–≤—ã–º–∏ API, —Ç–∞–∫ –∫–∞–∫ –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –æ–±—ã—á–Ω–æ –≥–æ—Ä–∞–∑–¥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ —Å—Ç–∞ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö.

---

### üß† –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –º—É—Å–æ—Ä–æ–≤–æ–∑. –û–Ω –Ω–µ –ø—Ä–∏–µ–∑–∂–∞–µ—Ç –∫ –≤–∞—à–µ–º—É –¥–æ–º—É –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤—ã –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç–µ –æ–¥–∏–Ω —Ñ–∞–Ω—Ç–∏–∫. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –≤—ã –∫–æ–ø–∏—Ç–µ –º—É—Å–æ—Ä –≤ –±–∞–∫–µ (–±–∞—Ç—á), –∏ –º—É—Å–æ—Ä–æ–≤–æ–∑ –∑–∞–±–∏—Ä–∞–µ—Ç –≤—Å—ë —Å—Ä–∞–∑—É –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –∫–æ–≥–¥–∞ –±–∞–∫ –ø–æ–ª–æ–Ω.

```mermaid
graph TD
    M1[Msg 1] --> B{Batcher}
    M2[Msg 2] --> B
    M3[Msg 3] --> B
    B -->|Size reached OR Timeout| Flush[Bulk Process]
    Flush --> Target[Database/API]
```

---

### üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –±–∞—Ç—á–µ—Ä –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ –¥–≤—É–º —É—Å–ª–æ–≤–∏—è–º: –ª–∏–±–æ –Ω–∞–∫–æ–ø–∏–ª–æ—Å—å –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –ª–∏–±–æ –ø—Ä–æ—à–ª–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (—Ç–∞–π–º–∞—É—Ç).

```go
package main

import (
	"fmt"
	"sync"
	"time"
)

// Batcher —Å–æ–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø–∞—á–∫–∞–º–∏
// Batcher collects messages and processes them in batches
type Batcher struct {
	mu       sync.Mutex
	batch    []string
	limit    int
	interval time.Duration
}

func NewBatcher(limit int, interval time.Duration) *Batcher {
	b := &Batcher{
		limit:    limit,
		interval: interval,
	}
	// –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–±—Ä–æ—Å–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
	// Starting backround flush process by time
	go b.autoFlush()
	return b
}

func (b *Batcher) Add(msg string) {
	b.mu.Lock()
	b.batch = append(b.batch, msg)
	
	if len(b.batch) >= b.limit {
		b.flushLocked()
	}
	b.mu.Unlock()
}

func (b *Batcher) autoFlush() {
	ticker := time.NewTicker(b.interval)
	for range ticker.C {
		b.mu.Lock()
		b.flushLocked()
		b.mu.Unlock()
	}
}

func (b *Batcher) flushLocked() {
	if len(b.batch) == 0 {
		return
	}
	fmt.Printf(">>> –û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞—Ç—á–∞ –∏–∑ %d —ç–ª–µ–º–µ–Ω—Ç–æ–≤: %v\n", len(b.batch), b.batch)
	b.batch = nil // –û—á–∏—â–∞–µ–º –±–∞—Ç—á
}

func main() {
	// –ë–∞—Ç—á –∫–∞–∂–¥—ã–µ 5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–ª–∏ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
	// Batch every 5 items or every 2 seconds
	batcher := NewBatcher(5, 2*time.Second)

	fmt.Println("–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π...")
	// Adding messages...

	// 1. –°—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ª–∏–º–∏—Ç—É (5 —Å–æ–æ–±—â–µ–Ω–∏–π)
	// Triggers by limit
	for i := 1; i <= 5; i++ {
		batcher.Add(fmt.Sprintf("msg-%d", i))
	}

	// 2. –°—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ç–∞–π–º–∞—É—Ç—É (2 —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≤–∏—Å–Ω—É—Ç)
	// Triggers by timeout
	batcher.Add("msg-6")
	batcher.Add("msg-7")

	time.Sleep(3 * time.Second)
	fmt.Println("–†–∞–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
}
```

---

### üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å**: –†–µ–∑–∫–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É (TPS) –∑–∞ —Å—á–µ—Ç —É–º–µ–Ω—å—à–µ–Ω–∏—è –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
2. **–ó–∞–¥–µ—Ä–∂–∫–∞ (Latency)**: –û–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —Ç–∞–∫ –∫–∞–∫ –ø–µ—Ä–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –±–∞—Ç—á–µ –∂–¥—É—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç–∞.
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í–∞–∂–Ω–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å —Å–±—Ä–æ—Å (flush) –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ.

> [!IMPORTANT]
> –ë–∞—Ç—á–∏–Ω–≥ ‚Äî —Å–∞–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —É—Å–∫–æ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ SQL/NoSQL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫—É –ª–æ–≥–æ–≤ –≤ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
