# Defer –≤ Go: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ ‚è±Ô∏è

`defer` ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –≤ Go, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –æ–∫—Ä—É–∂–∞—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è (–ª–∏–±–æ —á–µ—Ä–µ–∑ `return`, –ª–∏–±–æ –∏–∑-–∑–∞ –ø–∞–Ω–∏–∫–∏).

---

## 1. –ú–µ—Ö–∞–Ω–∏–∫–∞ —Ä–∞–±–æ—Ç—ã ‚öôÔ∏è

### –û—á–µ—Ä–µ–¥—å LIFO (Last-In-First-Out) üìö
–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ, –æ–±—Ä–∞—Ç–Ω–æ–º –∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏—é. –≠—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Å—Ç–µ–∫: –ø–æ—Å–ª–µ–¥–Ω—è—è –¥–æ–±–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–µ—Ä–≤–æ–π. –≠—Ç–æ –∫—Ä–∞–π–Ω–µ —É–¥–æ–±–Ω–æ –¥–ª—è –ø–æ—ç—Ç–∞–ø–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.

```go
func main() {
    defer fmt.Println("–ü–µ—Ä–≤—ã–π")
    defer fmt.Println("–í—Ç–æ—Ä–æ–π")
    defer fmt.Println("–¢—Ä–µ—Ç–∏–π")
    // –í—ã–≤–æ–¥: –¢—Ä–µ—Ç–∏–π, –í—Ç–æ—Ä–æ–π, –ü–µ—Ä–≤—ã–π
}
```

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ üìù
–ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ `defer` –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è **–≤ –º–æ–º–µ–Ω—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è**, –∞ –Ω–µ –≤ –º–æ–º–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

```go
func main() {
    i := 0
    defer fmt.Println(i) // i –±—É–¥–µ—Ç 0, —Ç–∞–∫ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∑–¥–µ—Å—å
    i++
    return
}
```

---

## 2. Defer –∏ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è üîÑ

`defer` –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ `defer` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ** —Ç–æ–≥–æ, –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `return` —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∞ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–æ **–¥–æ** —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏.

```go
func result() (x int) {
    defer func() {
        x++ // –ò–∑–º–µ–Ω—è–µ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    }()
    return 5 // x —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 5, –∑–∞—Ç–µ–º defer –¥–µ–ª–∞–µ—Ç x = 6
}
```

---

## 3. Panic –∏ Recover üõ°Ô∏è

`defer` —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å `recover()` –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –ø–∞–Ω–∏–∫–∏ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–∞–¥–µ–Ω–∏—è –≤—Å–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã.

```go
func safeFunction() {
    defer func() {
        if r := recover(); r != nil {
            fmt.Println("–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ –ø–∞–Ω–∏–∫–∏:", r)
        }
    }()
    panic("—á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫")
}
```

### –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Panic/Recover: ‚ö†Ô∏è
1. **Scope (–û–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏)**: –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø–æ–π–º–∞—Ç—å –ø–∞–Ω–∏–∫—É –∏–∑ –¥—Ä—É–≥–æ–π –≥–æ—Ä—É—Ç–∏–Ω—ã. –ö–∞–∂–¥–∞—è –≥–æ—Ä—É—Ç–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —Å–≤–æ–π `defer/recover`.
2. **–¢–∏–ø—ã –æ—à–∏–±–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï–õ–¨–ó–Ø –ø–æ–π–º–∞—Ç—å**:
    - **Out of Memory (OOM)**: –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏, —Ä–∞–Ω—Ç–∞–π–º Go –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å. `recover` –∑–¥–µ—Å—å –Ω–µ –ø–æ–º–æ–∂–µ—Ç.
    - **Stack Overflow**: –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç–µ–∫–∞ —Ç–∞–∫–∂–µ –Ω–µ–ª—å–∑—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ `defer`.
    - **Fatal errors** –≤ —Ä–∞–Ω—Ç–∞–π–º–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏).

### –ß—Ç–æ –ú–û–ñ–ù–û –ø–æ–π–º–∞—Ç—å: ‚úÖ
- **Runtime panics**: –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å, —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ nil-—É–∫–∞–∑–∞—Ç–µ–ª—è, –≤—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —Å–ª–∞–π—Å–∞. –≠—Ç–∏ –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∏—Ä—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–∞–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–π `defer` –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å.

---

## 4. –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å defer? üéØ

1. **–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤**: –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤ (`f.Close()`), —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏–ª–∏ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤.
2. **–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º—å—é—Ç–µ–∫—Å–æ–≤**: `defer mu.Unlock()` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º—å—é—Ç–µ–∫—Å –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω –¥–∞–∂–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø–∞–Ω–∏–∫–∏.
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ó–∞–º–µ—Ä –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞.
4. **–°–Ω—è—Ç–∏–µ Panic**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–∞–¥–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫.

---

## 5. –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å üöÄ

- **–°—Ç–µ–∫**: –û–±—ä–µ–∫—Ç—ã `defer` —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–≤—è–∑–∞–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≥–æ—Ä—É—Ç–∏–Ω—ã (`g`). –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –≤ –∫—É—á–µ (—Ö–æ—Ç—è –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Go (1.13+) –ø–æ—è–≤–∏–ª–∏—Å—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ "open-coded defers", –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –≤—ã–∑–æ–≤—ã –ø–æ—á—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤).
- **–ê—Ä–≥—É–º–µ–Ω—Ç—ã**: –í—Å–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞ `defer`. –≠—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ (–ª—É—á—à–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–∏).

> [!IMPORTANT]
> –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `defer` –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–æ–≤ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏—Ç–µ—Ä–∞—Ü–∏–π, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–æ. –í—Å–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –±—É–¥—É—Ç –∫–æ–ø–∏—Ç—å—Å—è –¥–æ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –≤—Å–ø–ª–µ—Å–∫—É –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏.

---

## –ò—Ç–æ–≥ –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é

| –û—à–∏–±–∫–∞ | –ú–æ–∂–Ω–æ –ø–æ–π–º–∞—Ç—å —á–µ—Ä–µ–∑ defer/recover? |
| :--- | :--- |
| –î–µ–ª–µ–Ω–∏–µ –Ω–∞ 0 | ‚úÖ –î–∞ |
| Nil pointer dereference | ‚úÖ –î–∞ |
| Index out of range | ‚úÖ –î–∞ |
| Stack Overflow | ‚ùå –ù–µ—Ç |
| Out of Memory (OOM) | ‚ùå –ù–µ—Ç |
| –ü–∞–Ω–∏–∫–∞ –≤ –¥—Ä—É–≥–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ | ‚ùå –ù–µ—Ç |
