### ‚è±Ô∏è –ë–µ–Ω—á–º–∞—Ä–∫–∏ –∏ –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Go

**–ë–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞. –í Go —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–∞–∫–µ—Ç–∞ `testing`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—è –∏ —Å–∫–æ–ª—å–∫–æ –ø–∞–º—è—Ç–∏ –æ–Ω–∞ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç.

---

# 1. üìù –û—Å–Ω–æ–≤—ã –±–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥–∞

–ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø–∏—à—É—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö `_test.go` –∏ –∏–º–µ—é—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä—É `func BenchmarkXxx(b *testing.B)`.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –±–µ–Ω—á–º–∞—Ä–∫–∞:

```go
func BenchmarkMyFunction(b *testing.B) {
    for i := 0; i < b.N; i++ {
        MyFunction()
    }
}
```

- **`b.N`**: –≠—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–æ–µ —á–∏—Å–ª–æ, –∫–æ—Ç–æ—Ä–æ–µ Go –ø–æ–¥–±–∏—Ä–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª —Å—Ç–æ–ª—å–∫–æ —Ä–∞–∑, —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–æ–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –æ–∫–æ–ª–æ 1 —Å–µ–∫—É–Ω–¥—ã).

### –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å:
```bash
go test -bench=.          # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –±–µ–Ω—á–º–∞—Ä–∫–∏
go test -bench=MyFunc     # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫
go test -bench=. -benchmem # –ü–æ–∫–∞–∑–∞—Ç—å –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏
```

---

# 2. üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º

–ò–Ω–æ–≥–¥–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç—É –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º —Å–∞–º —Ç–µ—Å—Ç. –ß—Ç–æ–±—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—ã–ª —á–µ—Å—Ç–Ω—ã–º, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã `b`:

- **`b.ResetTimer()`**: –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è. –í—ã–∑—ã–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ —Ç—è–∂–µ–ª–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏.
- **`b.StopTimer()` / `b.StartTimer()`**: –ü–æ–∑–≤–æ–ª—è—é—Ç –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –∑–∞–º–µ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏ –∫–æ–¥–∞.
- **`b.ReportAllocs()`**: –í–∫–ª—é—á–∞–µ—Ç –æ—Ç—á–µ—Ç –æ–± –∞–ª–ª–æ–∫–∞—Ü–∏—è—Ö –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ (–∞–Ω–∞–ª–æ–≥ —Ñ–ª–∞–≥—É `-benchmem`).

```go
func BenchmarkComplex(b *testing.B) {
    data := prepareHugeData() // –¢—è–∂–µ–ª–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
    b.ResetTimer()            // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –≤—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏

    for i := 0; i < b.N; i++ {
        Process(data)
    }
}
```

---

# 3. ‚ö†Ô∏è Best Practices (–ö–∞–∫ –Ω–µ –æ–±–º–∞–Ω—É—Ç—å —Å–µ–±—è)

### 1. –ò–∑–±–µ–≥–∞–π—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ üß†
–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ "–≤—ã–∫–∏–Ω—É—Ç—å" –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏, –∏ –±–µ–Ω—á–º–∞—Ä–∫ –ø–æ–∫–∞–∂–µ—Ç 0 –Ω—Å.

**–ü–ª–æ—Ö–æ:**
```go
func BenchmarkBad(b *testing.B) {
    for i := 0; i < b.N; i++ {
        fmt.Sprintf("hello %d", i) // –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç —ç—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
    }
}
```

**–•–æ—Ä–æ—à–æ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é):**
```go
var result string

func BenchmarkGood(b *testing.B) {
    var r string
    for i := 0; i < b.N; i++ {
        r = fmt.Sprintf("hello %d", i)
    }
    result = r // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, —á—Ç–æ–±—ã –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ —É–¥–∞–ª–∏–ª –∫–æ–¥
}
```

### 2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ üöÄ
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –∫–æ–¥ –≤–µ–¥–µ—Ç —Å–µ–±—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≥–æ—Ä—É—Ç–∏–Ω:

```go
func BenchmarkParallel(b *testing.B) {
    b.RunParallel(func(pb *testing.PB) {
        for pb.Next() {
            MyConcurrentFunc()
        }
    })
}
```

---

# 4. üîç –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (pprof)

–ï—Å–ª–∏ –±–µ–Ω—á–º–∞—Ä–∫ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ –∫–æ–¥ –º–µ–¥–ª–µ–Ω–Ω—ã–π, –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å **–ø–æ—á–µ–º—É**. –î–ª—è —ç—Ç–æ–≥–æ –≤ Go –µ—Å—Ç—å `pprof`.

### –¢–∏–ø—ã –ø—Ä–æ—Ñ–∏–ª–µ–π:
1. **CPU Profile**: –ì–¥–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –ø—Ä–æ–≤–æ–¥–∏—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.
2. **Heap (Memory) Profile**: –ö—Ç–æ –∞–ª–ª–æ—Ü–∏—Ä—É–µ—Ç –ø–∞–º—è—Ç—å –∏ –≥–¥–µ –æ–Ω–∞ –∂–∏–≤–µ—Ç.
3. **Alloc Profile**: –í—Å–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –æ—á–∏—â–µ–Ω–∞ GC).
4. **Goroutine Profile**: –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –≥–æ—Ä—É—Ç–∏–Ω.
5. **Mutex/Block Profile**: –ì–¥–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å—Ç–æ–∏—Ç –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

### –ö–∞–∫ —Å–Ω—è—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ –±–µ–Ω—á–º–∞—Ä–∫–∞:
```bash
go test -bench=. -cpuprofile=cpu.prof -memprofile=mem.prof
```

### –ö–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```bash
# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Å–∞–º—ã–π —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–±)
go tool pprof -http=:8080 cpu.prof

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –≤ –∫–æ–Ω—Å–æ–ª–∏
go tool pprof cpu.prof
(pprof) top10      # –¢–æ–ø-10 —Ñ—É–Ω–∫—Ü–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
(pprof) list Func  # –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ —Å—Ç—Ä–æ—á–∫–∞–º
```

---

# 5. üìΩÔ∏è Execution Trace (`runtime/trace`)

–ï—Å–ª–∏ `pprof` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ç–æ `trace` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—Ç–∞–π–º–ª–∞–π–Ω**: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–ª–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã, –∫–æ–≥–¥–∞ –≤–∫–ª—é—á–∞–ª—Å—è GC, –Ω–∞ –∫–∞–∫–∏—Ö —è–¥—Ä–∞—Ö –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –∫–æ–¥.

**–ó–∞–ø—É—Å–∫:**
```bash
go test -bench=. -trace=trace.out
go tool trace trace.out
```

---

# 6. üéì –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å–æ–≤–µ—Ç—ã

- **Inlining**: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, –Ω–µ —Å–ª–∏—à–∫–æ–º –ª–∏ –±–æ–ª—å—à–∞—è –≤–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–ª–∞–π–Ω–∏–Ω–≥–∞ (`go build -gcflags="-m"`).
- **Escape Analysis**: –ü–æ–Ω–∏–º–∞–π—Ç–µ, —É—Ö–æ–¥–∏—Ç –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ –∫—É—á—É (heap). –ê–ª–ª–æ–∫–∞—Ü–∏–∏ –≤ —Å—Ç–µ–∫–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã.
- **Benches vs Tests**: –ë–µ–Ω—á–º–∞—Ä–∫–∏ ‚Äî —ç—Ç–æ –ù–ï —Ç–µ—Å—Ç—ã. –û–Ω–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å, —Ç–æ–ª—å–∫–æ —Å–∫–æ—Ä–æ—Å—Ç—å.
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ –Ω–∞ –Ω–æ—É—Ç–±—É–∫–µ, –∫–æ—Ç–æ—Ä—ã–π –≤ —ç—Ç–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É –∏–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —Ä–∞–∑–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –ø–∏—Ç–∞–Ω–∏—è (—á–∞—Å—Ç–æ—Ç–∞ CPU –º–æ–∂–µ—Ç —Å–∫–∞–∫–∞—Ç—å).

---

### üìä –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å?
| –ü—Ä–æ–±–ª–µ–º–∞ | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –§–ª–∞–≥ / –ö–æ–º–∞–Ω–¥–∞ |
| :--- | :--- | :--- |
| –û–±—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å | `testing.B` | `go test -bench=.` |
| –£—Ç–µ—á–∫–∏ / –ê–ª–ª–æ–∫–∞—Ü–∏–∏ | Mem Profile | `go test -benchmem` |
| –ü—Ä–æ—Å—Ç–æ–π –≤ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö | Mutex Profile | `-mutexprofile=mutex.out` |
| –ù–µ–ø–æ–Ω—è—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ | Trace | `-trace=trace.out` |
